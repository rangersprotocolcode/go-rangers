// Copyright 2020 The RocketProtocol Authors
// This file is part of the RocketProtocol library.
//
// The RocketProtocol library is free software: you can redistribute it and/or modify
// it under the terms of the GNU Lesser General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// The RocketProtocol library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
// GNU Lesser General Public License for more details.
//
// You should have received a copy of the GNU Lesser General Public License
// along with the RocketProtocol library. If not, see <http://www.gnu.org/licenses/>.

package group_create

import (
	"com.tuntun.rocket/node/src/common"
	"com.tuntun.rocket/node/src/consensus/groupsig"
	"com.tuntun.rocket/node/src/consensus/model"
	"com.tuntun.rocket/node/src/consensus/vrf"
	"com.tuntun.rocket/node/src/middleware/types"
	"encoding/json"
	"io/ioutil"
	"strings"
)

const (
	robinGenesisGroup   = `{"GroupInfo":{"GroupID":"0xd588982453c1f6278564b44667573ec3eb6ce326a63e33e89b091cfe3de2a887","GroupPK":"0x608fdd9a055d2e688401220c9e3d0e9c2f26c354b3be07f1a06c4c6d769ae3cd38828f2c7b5b531fff8306a61fbdfa94e5eb59cecff7b28f4abba21f6037a2792d36d3544b2d7057405482a2ebde48f06e302dd1c91fbb6a47d393bb3f19f5660e2909d46e8445f857f1e63dff2bd10913663ca3c8a6bcbc64b0d49d92693251","GroupInitInfo":{"GroupHeader":{"Hash":"0x275d1ec7e591231e9de02a0d29cf465a5dfed5aea15feff938f85714bcc52296","Parent":null,"PreGroup":null,"Authority":777,"Name":"GX genesis group","BeginTime":"2020-12-23T10:31:42.523464+08:00","MemberRoot":"0x519750e82dd561f03eabae5ee7d1f11df0f6c14eb356757ad7bb7de7a51f1448","CreateHeight":0,"ReadyHeight":1,"WorkHeight":0,"DismissHeight":18446744073709551615,"Extends":""},"ParentGroupSign":{},"GroupMembers":["0x5437f9dd7171db9d04a8347dca5bf2b7789081631d79d2d7882c1774d2f4d123","0x2a17671c5a32175335fa098951ba50a9b4730aea7ecee86df6536297900f5b77","0xb1979dd362353f0b59dff76cb223d5660a024db628257693f5470dec18c93160"]},"MemberIndexMap":{"0x2a17671c5a32175335fa098951ba50a9b4730aea7ecee86df6536297900f5b77":1,"0x5437f9dd7171db9d04a8347dca5bf2b7789081631d79d2d7882c1774d2f4d123":0,"0xb1979dd362353f0b59dff76cb223d5660a024db628257693f5470dec18c93160":2},"ParentGroupID":"0x0000000000000000000000000000000000000000000000000000000000000000","PrevGroupID":"0x0000000000000000000000000000000000000000000000000000000000000000"},"VrfPubkey":["JevvUFyYiszl6wg3fPRA1zUBo8TKiphhjJy7Hy0nfcU=","8QZCqd7xDETZ1eA3QaQJUWsAcwYCwrM43UhyLGh9VP4=","mLYbDvkkPQFwnVRZCI59t1iLum4qdMIkEzADhpohvRY="],"Pubkeys":["0x81b7daee9550ac17c0446cb42bcf8cc87155fa36d641320fd351f5cfc5ce435a20457d5f3fe83d79aff4fb2cbcc0812242040d066463998eb5729866f1ce3979671fb242204c961cf2723321729aacbfff2c014f943ab8794785be47319efd76078d7cc657750903e24be9f09685fee361d321963fbc93075b9bdb18dd6f53f1","0x27bfa326a01e6640f61666801a6fc1acc37a18d5d4804c92e304dacef25d606f385fe9f050aeb4d5c9ee4c9d442dd535d65380aa26bfc33d92ab6007b91afdf41ddd68c1c6ab3e11154578eea8a364084fe8e4b263d675dd44ad8be223b75bcc0db0d4cbc4651eb2e5351ab5e01f3d3298227bbe342692582ab5afff39d237b9","0x2ece69e08094f7cdd3f19db009b907225438eea203ac19a27b2c7ac43350569105549567de059c3d247dd2fb9190f77f732d89f84d7540c752b7f837fabad6498c1570d42804397c1beee1876548b0c7abf804076dcfab61511dbd6a84b480230e90cfe8c2fa03e6e997fac2b5507f79eb6a2fdd215cc92bf343b7473b4b4df1"]}`
	mainNetGenesisGroup = `{"GroupInfo":{"GroupID":"0x38f97eeeef60ac0e00b10f44541899455149781bf57b6823c6ade348e7c40f04","GroupPK":"0x80dfe956461155146363624d8dd27bea37d1139aedb5c28fc2fd22dc1aabfc8615a7bf893960860ae1dbdd3efb34d5d2e69a0311aac8cbacf010be87a89af694892b20701373ace414dbf4cfe0dccc7bd23e50abd4a9d17cfbde4876f59409a36ea645d05087a8a3c6557e56371dabeea03527cba8dc67d47c5e795892b0787b","GroupInitInfo":{"GroupHeader":{"Hash":"0x7b443efc6db49b0984f032f28766c6fca60c31d3da193949116c38792dcb4b1c","Parent":null,"PreGroup":null,"Authority":777,"Name":"Rangers Protocol Genesis Group","BeginTime":"2021-12-03T13:26:26.686415+08:00","MemberRoot":"0x05ca87f791ce5998a1399e2af3d605a4ece84457370ed2d3a1ae681fb26dde85","CreateHeight":0,"ReadyHeight":1,"WorkHeight":0,"DismissHeight":18446744073709551615,"Extends":""},"ParentGroupSign":{},"GroupMembers":["0xe733dda089d1127d2b442a323f616812f8550966a8af4a54d7849ad675463ca5","0x880f07e9cb8424d610aeccd4b2cc06a0a0b1ebf7a27fcc67420c84dc2cc64492","0x01d66f9b6fb802ce79516d58e98e31f170105b8c0523f96228a7b0f217605fbd","0xcd9872ddf50e5f058a6ad958cfe2149697e79fa7764b6aced358c0403e745c9f","0xd4c15e789357f8c860b1c55d251dd9cdbeb580ae1a132d83dc19a936f5bba41f","0x871915f7d1cd07767f4d7b9bbf8a5dbf91d89ff26649805ac767c13d75fef6fc","0x160b321d96c05393da1dedbea5d0905b9c7a41bc90da2779d77121ece33cb07d","0xd0815a3858f224b8baeee9c2e8d5732dbab12a7e97601e58d250dc23ce64fa7b","0x7ed35793cb96803d8a4c82be6a70f792de2420253fb38790e79bc5f4fb4d79dc","0x528e680cb4310cb0b745ef85f67d2a49bb03eb8622b0aa6cef65e3c3d7aff696"]},"MemberIndexMap":{"0x01d66f9b6fb802ce79516d58e98e31f170105b8c0523f96228a7b0f217605fbd":2,"0x160b321d96c05393da1dedbea5d0905b9c7a41bc90da2779d77121ece33cb07d":6,"0x528e680cb4310cb0b745ef85f67d2a49bb03eb8622b0aa6cef65e3c3d7aff696":9,"0x7ed35793cb96803d8a4c82be6a70f792de2420253fb38790e79bc5f4fb4d79dc":8,"0x871915f7d1cd07767f4d7b9bbf8a5dbf91d89ff26649805ac767c13d75fef6fc":5,"0x880f07e9cb8424d610aeccd4b2cc06a0a0b1ebf7a27fcc67420c84dc2cc64492":1,"0xcd9872ddf50e5f058a6ad958cfe2149697e79fa7764b6aced358c0403e745c9f":3,"0xd0815a3858f224b8baeee9c2e8d5732dbab12a7e97601e58d250dc23ce64fa7b":7,"0xd4c15e789357f8c860b1c55d251dd9cdbeb580ae1a132d83dc19a936f5bba41f":4,"0xe733dda089d1127d2b442a323f616812f8550966a8af4a54d7849ad675463ca5":0},"ParentGroupID":"0x0000000000000000000000000000000000000000000000000000000000000000","PrevGroupID":"0x0000000000000000000000000000000000000000000000000000000000000000"},"VrfPubkey":["THJSTfGTY4QAvc2GFeKdttU1Yt7Gh2J4sllbBPscoRk=","/Jlj0SE3AE6W/nZAmK4GHbm8p4sa3i2E2K52bP/UD0g=","bXvzKhjJxaLVFDlPxfSmB5dPLZbEsRbndaAsP/zm84M=","dAofvKM4dIdfaUaknZ9py8Pm3Sejt4CQR4PI7DMcIDM=","mI1Hdwv9x5rNYEXcUB+PZwXHG+5VRSYPF7B/PEJPJ0c=","M83VNJ0ygVDukeyQZT09wvszuQ/rOX/cIKXSZYHiMGs=","bx0XWMT9QaehgQfbANvddqwdrFysvbLTqf/KWAQLEW8=","FXdhSJVzFI+CSncvE5iIuVoA8IkubEC0pVl9j5GwPjw=","uP/fV4Gn0U/2vlAkuLti6OkOYOEd7TbTIdm9bXrCzpE=","NtoD8Wvi6CIhkwl1Mn0pb5CtF6rDoLHPYEjew9lek48="],"Pubkeys":["0x8b55628e8ccc5860d1f9bc4808946de061b67ae37c5b887a4fced24a7e9e555f4306224299ec72f23940e24f89722a49c2dd6c77320a701e507a95d93db0760633436782fb6b43b34c2467fe222f935cfb1df52ee17693c479461bafce78ae392ded0347317e28bb506fc89f0ce2721751dc1db2f57c76167da2836f5d0b1ff1","0x28f8c93c6ba1f9926ec18ba0632bb235687986047c72b9d1557acce75a9b5df888b672316b512b065835f5c576f7d3d4dbfd5176e325f18af7303012a4d9382e7741bebf6648a704f7c6cec8fa7f64fd1cefa536bc384d9c17946f9d56d3df41837f3163e5a49889092f8c6073ad7744c3f4b96b327ab36a07ae19453f9520cf","0x0aa49c19b3bb740aa7f09df1c45e66ed3edb90f13842592a547e3b75b96b705034173a6bc9942ee8db9e15a11e53d6c320bfe002a76b88ac587d166e8d9a416e2e6bb891d6a6cbf4fcdad2c0d0ebeefe4b0075c93f0951454c96a738af1f65445cd4cf628ff767982d7dda314c9f691004148a5a8c4eee9d48a7ff9f529c4b4b","0x43f5bb4fcce4d7425f4b28f272f79065319b727143ec51254979cc54190b616413960bc13d95c7c0f19f22de9b969b42bec3bd2b7091f1d1a252a78994363afd2a8b8788d1acfccaf1976cb2073902879f98ca671ec6c391fe927fe92ee687c9510d7ad9b6e0fffe8ff7a4a7c5dcce5434cfb0b2fc338d6e004cf0d0948e99fd","0x15e1aa6791bf01719f211812b59ba6e8f853377b8c224e4d01256c5854fac991138c454de1a72034cc1e54dce0f3430cdb320f1581f5da3f2a018ef4a4673374497656db78dd459f20b2be3d565e503be1120ea4527cd8edb202165d888119d2036bb028d0cdf891ce210b971eef40af2a27db4fd5b113d8e081eb2f31ccf1f6","0x42d3fea5ad6ffc4007e2994333dac0e0d755bc1784f0bcb5d76a88fee5940a5836dc31a84ecb51716195e4d6438df68e627df4b121afe96340aafd49a6f8ed237693dc55c8cb37ceebc66aa39d0ef83c1180030bad4ec242364401bfaceed58c572378c675d28ecb92c7f1c228b029c46ab8785a4b8adab97d263a62ca4e677e","0x74860aa0e71c1dfdef0cd07f29530e51c398a7b044b83c47ff260f741674b4295bd91d6aa4855064a1287e7f6970dbc2ec19e5a157306a69897d742a8db60f1f80566c20783168e0724bb6061400ad950d3038b5bff6197e4dd73f02dbe2537e319a39c97931446861762e21ccc415fd3bea749bfbc65d81ad9f133102aff558","0x15c96eb18f35138c202ce9ea9884ed055c3375a666c3dcd3f265b4c919f0e8927a212193533e90aa4408ce319bfe8b0279e3033efa2c48f302dd9e716c844ebb0b2a0ed66f07a863657485d8f0539c067a98d2dca64694546744bc44af4f3a06045bc2e68bf64f47a914a131a281a3beb634cfd2379a19254d1cb030f88b102e","0x4eb0aada6e76cff82cc7c0eb52e03135df79729779abd70082812821adcf2e31492a223bf11f81a08975c5978f50a65bc416ef28e9cf3c9f33a36ec494a24a84438c39899975171d11d9dac0f3ab45e24739dbbc9e9ecb27ce4ba940df6d75130272b5d1da0382da699ef84afcfd425e8efadf66633bc60571c260454e2683de","0x73882be0f806f14fb13def125ad2f841c6249bb49eb340661e72b4a561951e811c25619e0132c317a831561063cd32029d6c23c1f4540ce27ff856d5d054472c6e0f75453910b18bcfb88efee06512ba669081bec16da930a2c0954fff7a0cd037df78aa91d1579d3821ae9bdaa191f81ee5b397068c50e722ea379050a05ea4"]}&&{"GroupInfo":{"GroupID":"0x6369654798114f0626f4884eaf9ad74404aac5adefe2fd4b6496f17f593bde25","GroupPK":"0x88e1bbfc7890bfbf0a54c012f5777e37f83428910a6eac3d0d707d857ed937f11eec3612eed58fe3342afd9731d4d38d7658ad005dddf5e138aa913fd5f3fe57368713915597a5b9809ed5da4491f8a5d8b830bb68ca17402c2aa32e7ad2bacd7ddf39286b65608370b47d744fd88afaea2d8345a93c1e3d5a2caf5588949518","GroupInitInfo":{"GroupHeader":{"Hash":"0xe4f0bc8514e4137afd602aa360afc39af5f140483eedd25af041c1a0fec3451a","Parent":"0x38f97eeeef60ac0e00b10f44541899455149781bf57b6823c6ade348e7c40f04","PreGroup":"0x38f97eeeef60ac0e00b10f44541899455149781bf57b6823c6ade348e7c40f04","Authority":777,"Name":"Rangers Protocol Genesis Group","BeginTime":"2021-12-03T16:25:41.877648+08:00","MemberRoot":"0x7f5f17dcc1acc1872ead6ebee078e438e0a3a9421d63dbaca14bc03f855cb0a7","CreateHeight":0,"ReadyHeight":1,"WorkHeight":0,"DismissHeight":18446744073709551615,"Extends":""},"ParentGroupSign":{},"GroupMembers":["0x1c91ac48475877d73687f6876157cb9571c7b22372d69c3956b31a17b85cf5f3","0xcf7eb50f106e63e68e218402bab0660df59a8fb272caabc09dd3d7c018bc0a53","0x631da15ac1e4327acca7e2d25ac4bbbaaf06c73199e5d6c64c603d51a3668aa9","0xe4a2342131f855a10b344cbed3ea050f429831fd35f6ef89224cd812753bfad2","0x28826f3724fedfd3789364072b257edadb055851f734ba3e629a1eb6312b74ca","0xa629750500a13043d42d21d3547e3dae2c52aa27b2afeff506beb6b9d0531be3","0x5196c80756cf71eaf4e3b7e804542945e1503cce70550c81c45a12d47a6a707f","0xa19ee3966b16ae50ed3f62a5e5ebc7976a38124bbecb7b141629aeeaa338a496","0x89e87ebe7c88b3b8863796eb6138e4baf9ea707cedab8867e95096eee53f09ef","0xeedb03fc18a307aae51fa8a53542c5010f215c98d313255fec31ea6c60bf3e7f"]},"MemberIndexMap":{"0x1c91ac48475877d73687f6876157cb9571c7b22372d69c3956b31a17b85cf5f3":0,"0x28826f3724fedfd3789364072b257edadb055851f734ba3e629a1eb6312b74ca":4,"0x5196c80756cf71eaf4e3b7e804542945e1503cce70550c81c45a12d47a6a707f":6,"0x631da15ac1e4327acca7e2d25ac4bbbaaf06c73199e5d6c64c603d51a3668aa9":2,"0x89e87ebe7c88b3b8863796eb6138e4baf9ea707cedab8867e95096eee53f09ef":8,"0xa19ee3966b16ae50ed3f62a5e5ebc7976a38124bbecb7b141629aeeaa338a496":7,"0xa629750500a13043d42d21d3547e3dae2c52aa27b2afeff506beb6b9d0531be3":5,"0xcf7eb50f106e63e68e218402bab0660df59a8fb272caabc09dd3d7c018bc0a53":1,"0xe4a2342131f855a10b344cbed3ea050f429831fd35f6ef89224cd812753bfad2":3,"0xeedb03fc18a307aae51fa8a53542c5010f215c98d313255fec31ea6c60bf3e7f":9},"ParentGroupID":"0x38f97eeeef60ac0e00b10f44541899455149781bf57b6823c6ade348e7c40f04","PrevGroupID":"0x38f97eeeef60ac0e00b10f44541899455149781bf57b6823c6ade348e7c40f04"},"VrfPubkey":["mUZ1AIVOsMCHwyjw9u938g7kp04f7ax4SepXOYTzfzk=","KrSKShcRBgFPD0l3Z81NlzqNfbrE4yOmv1+CVSSYeQA=","SWSZJhLp2qf6wPn/FftaJDbF6djZSzPJl+3JLjeVCWk=","19rprVWYlGzu7l5BQvU4x5mzUzu8W1ucIb7cG/MnIMY=","00PTbbRxNnR7VurMq5BOC2hU1DZxx+gtv2qu2BYm2zk=","AOg5nE7snsYz6UvK+vCMuzXBQHZqmTITq8oOsTEN2H8=","t/bRZUKm2snZW3zhAp49axyEE7r7xId8CAqk/tdxd2s=","cP1DWTRvTnVcg3tZ4qxXqjTQ4NS1mt25eCWMBAGRAS0=","wxDRcQlMKswo4dn9l/jODsmkivlDJlTjPFFk2jWfAac=","uQG/XStioJYEk39O49/HeES6x2QxrJAcm7dPOAS2g+o="],"Pubkeys":["0x318e236ccbcdbd9b364f27b07ffaae118977b8c89beb7fb0f3e89f48780fd3220c25af5e1f41f74f8ef628cbf0e9230807011c7ff1501e35066aa4fd8e4166a9633fb44485ac71549a1328aa94cd33b6e95efcea01d792b678ac512b038a513260db9dac94c7687b646b7616b855f0a007b160442c9bd0f756bef022a40fc511","0x54b36f2dcddbe521910aea73d507589c25f8543e8965eb76af1719fff873509e2d4e5b51ccb83c29721b95b67553a40a87001eec581c0037e095e30abc3f602740640e8b81b9868834d16161b4463a72393e95a60803555f3d93f697ab4ca10765d32567ff20674c845fd821af30791dce149f55dc521be2cbefa57eee33dc7e","0x7d4b4b294f88d63e1e2c046e98a02c054e9988706427b0bb57a4f1b18cce391777bee21c45bae755bb3469febfc8954f0bd9b15a57afcc39dc941882c891cee10768a6c8d79c55ffe900e47bdb100e3acf6389fdd1b792cbda8a2910c44575791a44ed18bed3244220429addb35e3fd2bb849f55bf0bdeaffa04a8dd432a6c92","0x1358536c0b795f7194cb1fef279a8eeb64b8bf38174c4111ad7257ead665c23b5cb4f7acc878348aaccdbcbae2db32edcfd88406851e38186de396a96db525c23e9f4c1f1af69a3122fbaa40d2cde3ca299c8dd19aa80703babb0940465769065398836dbbe774aec018f71eb47b566e119af33f50f3c974aa3ddc8e00a8a7b7","0x55d558dd7d5b4dbce77c6756d7cacb2de9cec88c98684bd53ef994e4410a659324addeb18690e53fa7a8a2d7e95dc9707cf08c37fdb4d5be9325319812d31b31852572f72bdb2db95ce028b13761670775740fa71e66223c0717b6b1eb89ea2627ddb8621a629d6399ff03e4567c0b685a56b308fa18aab6c95d87ea9cdd9326","0x67fc5c305d76c6b7492db4e1f2970c4274c3a85c59d127f8f6b2873c6dcaafec882b109f0e77902a315afadf747481a8486e7ed7ce1d21e9d8ab97fdcdb75d1e5d8b9b30b9e285e2e9b426a174812ceeff511a7a390704baf9db65c69fd5f6924befd5c4ab9daeb58dcc9f7ea2babd0f6bd39439d2a5779d4b5d1e8d021947b0","0x879f0e40b076ce3525d195fb20252d0764b45c9c45cd50cd7c753b568afaef54741f0e301b31a40c0a2791691dd41c52ca11664f1a569e76adcfce25113d112a647c5b26a4d9405ad69036322b9e259ddb86caf46207f075203f3720e395ab0e59c49056350039e80e8eed146f3e6cf27f1228926aad4cb234c2a546c00ac87f","0x7eeb216a93527664da26f5a59527ba509ce4be33a0e2123c97ffaef7c4b084178a08bfd55c48f91d195616f04562b7db517d0733406f2ccfa39319c4113a8c2654d37f831e9c73667fea5eb5128802b4206df5974d438f2982bd7094aeb7bf516329cdb440324dda6bb964cdd4b803c2cdae29260463fc013646d1d4fb10eed3","0x8be4f026c8924f76a007f9cb8ebc934ec971078827c8d72169d64abfd0a9093f320dd3b3b17f1391a330d6cd75eeb50a7eec75d5382ea292c22d6d18ff5550d4577a9a7e9c506f23e36293a83e030c91e4a5463db1aca937da1aa42735c239d711b6d53d22a8eeba9fd0bd48cb9e59224a1104c32c2ddc11a4f37c81b63431a0","0x8757ee3742752cbb42bf5996d95d5292e286958457cddfc6e06df419bd03cdb0799c693b261917862458248bccbe86e2a79be0f5b8b9218cfda57c792b2e3b6410eef75be6dbf5cb1828983e222d3ecb5cbba269bdcf2440d3398a4ce864466929df24cc173045ee7c98510539a0855aa859cdfa8b25ba7dbb0588334e7cb714"]}`

	robinGenesisJoinedGroup   = `{"GroupHash":"0x275d1ec7e591231e9de02a0d29cf465a5dfed5aea15feff938f85714bcc52296","GroupID":"0xd588982453c1f6278564b44667573ec3eb6ce326a63e33e89b091cfe3de2a887","GroupPK":"0x608fdd9a055d2e688401220c9e3d0e9c2f26c354b3be07f1a06c4c6d769ae3cd38828f2c7b5b531fff8306a61fbdfa94e5eb59cecff7b28f4abba21f6037a2792d36d3544b2d7057405482a2ebde48f06e302dd1c91fbb6a47d393bb3f19f5660e2909d46e8445f857f1e63dff2bd10913663ca3c8a6bcbc64b0d49d92693251","SignSecKey":{},"MemberSignPubkeyMap":{"0x2a17671c5a32175335fa098951ba50a9b4730aea7ecee86df6536297900f5b77":"0x81765735aa48fa38eab581a961630adb459bca8b33a540faed3abaf5baa0a4e44ca776e946ffe9b857421c21062ac3837684b72ef36d174d140f0990972f1da94509dba0edb65dd72b647143776b0d6c25c3a47d0419581d2730bae0e3c0ca34450cfb9346b7fadd6737ffb2d78048ec0360f2a57eb8db870d79d8e51ca31817","0x5437f9dd7171db9d04a8347dca5bf2b7789081631d79d2d7882c1774d2f4d123":"0x6a2a1db50572d6f026ab8274357e961229dbc0dc73e6e5e746fc08237875dffd725bb28a4e4e7e4b5fcc299ab3ff2fb18e64b1822a44b4486b2045d34b5b7e2d8a6a90742f02122be4efd09c6fb454ce606ee80666fd75f792c0e96140bc6b9283b90f32b5916bfa721e18422f5255a73ca9330151367bbc1731ff797a5c7496","0xb1979dd362353f0b59dff76cb223d5660a024db628257693f5470dec18c93160":"0x8cad31d6d8a33b3de6cf964c23aa66e17e56b5aa5914c9d3702871a2e2b41cb63c34a8741ac08ac8d64147b3b72b4ea26f59e6257d26ff59dc0e5088ea0a7e3188d20929c11b012b1e6ed2c2ef4e4b29b9ca6b4e1bd5adff6b899fba6e9df731837b85e47e53969b414839ee28efc4a245e7489726b9c9e5ff2d50fa1e676a4d"}}`
	mainNetGenesisJoinedGroup = `{"GroupHash":"0x7b443efc6db49b0984f032f28766c6fca60c31d3da193949116c38792dcb4b1c","GroupID":"0x38f97eeeef60ac0e00b10f44541899455149781bf57b6823c6ade348e7c40f04","GroupPK":"0x80dfe956461155146363624d8dd27bea37d1139aedb5c28fc2fd22dc1aabfc8615a7bf893960860ae1dbdd3efb34d5d2e69a0311aac8cbacf010be87a89af694892b20701373ace414dbf4cfe0dccc7bd23e50abd4a9d17cfbde4876f59409a36ea645d05087a8a3c6557e56371dabeea03527cba8dc67d47c5e795892b0787b","SignSecKey":{},"MemberSignPubkeyMap":{"0x01d66f9b6fb802ce79516d58e98e31f170105b8c0523f96228a7b0f217605fbd":"0x0a1acf3c14dbd6423cf3f92c912a7ce56e0c3389dac8ead665dbf88d445be75636b41ff174939885adaa19dec41044aa53e46ff80594e2709b3dad4ab56208db4a9979d43c4d3b27a3187f58ce62c99a9e5c3bcfa2131a5110830e9500e963357443e25bd59c116f2a4de6df1c90ee1d808243eb578a048b49208bc925c2eb96","0x160b321d96c05393da1dedbea5d0905b9c7a41bc90da2779d77121ece33cb07d":"0x1ae731eacacf8d217a0f561ad3a156d2af322badd2ec5af55059163a090f75a782241b00b6768b6e83e81c0f29918e3dda731bb856a6cd930d8357a7cdc9ef7781af88445688e93b500d807507c18a12ae93cc4bc0bd724b34958d36f0bf0658026bc0a375b4689c350148ac6c05bdc315590c1720333e23e6150e4e6e021b73","0x528e680cb4310cb0b745ef85f67d2a49bb03eb8622b0aa6cef65e3c3d7aff696":"0x3c0f19a69576d7ab94284e5921fc21b5b990298a11d3fc0653db13d2b2fbe9107b87e7ef636e2e370cbf307abe1edb8f618c5121811683cb838a68aee3386ac2605571f51070e620ec4e8d8d9916f0989f28d81c8cde36c0a58b9f685615f2c952c858a1a16b7e55b1d29e3f17ea7800c40eeca638a4ae5e5c8a7c3cc3ca7ea4","0x7ed35793cb96803d8a4c82be6a70f792de2420253fb38790e79bc5f4fb4d79dc":"0x025c9c95d45d24d1a9a41e58726fbaec058ba923393d0d78a85759b1945a84e466999ec6626331ad83660e087c2c563d3f1f559de07df26029dc5f61d5f63efb4cd6f50e83559e0f2a91a8c0c6a4726ed3a62ef713289d6b1de4d3aee72ea68e2d3553292a9abbe31c69363b27847bec1198648edde48ece65d7e8364ace0c27","0x871915f7d1cd07767f4d7b9bbf8a5dbf91d89ff26649805ac767c13d75fef6fc":"0x71357e080ea2b7d8342dcb15605f381409425c3e5fb74b70ee557ae300e06fd877097f2d1b344804da5dbce07a3b4b7238190ee59bc797efe490f37f7e7eccca6b4ac22b6233e4c893de7a03297ee0b8e36bbbc38579cd4d9ae04b3de402cb780688b23ba1f75a1bc917c8545fa56109cea1bcef43722fbde62b7fa1125b86c8","0x880f07e9cb8424d610aeccd4b2cc06a0a0b1ebf7a27fcc67420c84dc2cc64492":"0x3b397a356b5347b38f279392c37b09ede56440a0e4f6c8707285ac6141b2464972a561f9a51955510a2a4c3a35b2ed0429ce92193ee65249d8ff0200f44b78ad54a9af1f0528e77bdc295f47b1e37034c74e1fe6586b541512a3beef14725954402dabed5b880b1d60acbac585e4f3c381c339332e4b39e9f451bb4574702cf6","0xcd9872ddf50e5f058a6ad958cfe2149697e79fa7764b6aced358c0403e745c9f":"0x3f305accedaedd673f62741d0ae07a04016e30f99536c81fcbdc22d292a08cbf89f896267001df194951da3c07f0fc5ad92146b4429b7769681e9920d43d31bf3d42b75ba704b63172504577b902d39e7452f099faad9799412c393be8cccca0746bc5798512f703ecf055beeb841be1ee88aa19fcbb16fae22f526aee6dcbc2","0xd0815a3858f224b8baeee9c2e8d5732dbab12a7e97601e58d250dc23ce64fa7b":"0x5a455951914477118265e9c4a219bf75f9be001930de3deb54651e853c610f8f1a9ebab293813cdda19b0322668d4e8d274add94107bfe5e03c652dc3dfcb43d07274b9b12750496350d6b1867320e2fc48ba5db711893cddf5feb9675eb1e896f67000eb1b9e5ec80b0772fa1692272bc79ee05a58905e6ae68da13bfd28ded","0xd4c15e789357f8c860b1c55d251dd9cdbeb580ae1a132d83dc19a936f5bba41f":"0x4e0796037387f837bde9aa89e55bb83cca4e43a113db7d866cef4a9f1492ce8761b91a860d9d6589cd8eced76d4e183cd1252e15fa4a503c78f671e11d37e6e4155349fa85b9de5777d2a884a51de518f9216d9e00df756ecb6acb78913245d1877bef3692086ad1314785df9a0fad3175d07e016c33dc91049a52277d2faca8","0xe733dda089d1127d2b442a323f616812f8550966a8af4a54d7849ad675463ca5":"0x18774dd63298a054f5e4a8035bf0fe95f9d11fe49334ffd1b66cb4adcda6b099124c7d20e5dbf354302a9cacd85f8c8b79709218d2725e2ec1ad4dfd590ecabd0cb994ab0e8388f742755eb13af63c1477830dd814630e5ac1c568d00939c91f833fee65d8887a978a818c36fc95494120e478b230f5fce15f52f64055d91881"}}&&{"GroupHash":"0xe4f0bc8514e4137afd602aa360afc39af5f140483eedd25af041c1a0fec3451a","GroupID":"0x6369654798114f0626f4884eaf9ad74404aac5adefe2fd4b6496f17f593bde25","GroupPK":"0x88e1bbfc7890bfbf0a54c012f5777e37f83428910a6eac3d0d707d857ed937f11eec3612eed58fe3342afd9731d4d38d7658ad005dddf5e138aa913fd5f3fe57368713915597a5b9809ed5da4491f8a5d8b830bb68ca17402c2aa32e7ad2bacd7ddf39286b65608370b47d744fd88afaea2d8345a93c1e3d5a2caf5588949518","SignSecKey":{},"MemberSignPubkeyMap":{"0x1c91ac48475877d73687f6876157cb9571c7b22372d69c3956b31a17b85cf5f3":"0x311f84c9f23e6c2d72f37e72070cb42bd681ee3a83f273c600f39d544c4f755513554dd6562da37ff121d9eed1f24b83a8b334d277b8c38a32b3d6d99291b5d221180fccb5f8c22b9e306cd281c66bb0e1cf7c92c54bb712d5a17b3850d713452def0f90861c39e04ee746475a698b62b395a7314cdbcafd90e3c6ce14c8152c","0x28826f3724fedfd3789364072b257edadb055851f734ba3e629a1eb6312b74ca":"0x1e45c5f2981be3ead5b2ab6ab07f751269218e1aa526070af0a38522b12966d31133b7dab16baebdec621f583f299e90429f5697324bf379f73c0f4a3ad247e52fc919dd9d28c2055afec82cef34d6efe82b8e087753d25845864be866559ce6007ac4b8a81d0dcc3ae07c774e784b3af394a2b96cd3728497541ec945ae945d","0x5196c80756cf71eaf4e3b7e804542945e1503cce70550c81c45a12d47a6a707f":"0x3db46db1fade33383d594b180fd8b7df3a9c90818b49af4214393d94fa466a386e368623ddc415c63a6f6a4a6ab8f6f5f8d534299b88e929fdaf679abe47ef7984b90f9f5dafb8e7ea4f19823bf8fca8f5b697bf62a9f38b9be22b8b72f12c627d599be8233815c14f464d095b5aab8f67c3d24331f4badce5573bec38187b31","0x631da15ac1e4327acca7e2d25ac4bbbaaf06c73199e5d6c64c603d51a3668aa9":"0x79abb5a31a68857cebf82d34c6139954f4fce09a5e8ff78b201b34164a80659f80c0bb2fe3a3b1966134fa40c53001956bc4457394f1dc3aa687e2fcfdf9a2d609c9a270948569f9e223db3e6d2b67fef0eaca10c1d1f186dd09e2984a1106228cbf79c8361c9827b1a10a075aec77447a43d95e419c28b0eb49a7609a1e49cb","0x89e87ebe7c88b3b8863796eb6138e4baf9ea707cedab8867e95096eee53f09ef":"0x2dd0eefac696d41cc43e14416d8f91cad1531bc368880bfca90868144ec4473c272e9f8ea7d65603d9730901e7cc9d58f2358aefe27d3479fe2b579354b83b600f65943ef74507bfec641a48643a1e5a388db17b134d0ebcc1df4e0cc9513cd533180d4b991121bae01403e7eb395e67c110dd0d4cc9eb8fb428e4f16f1475c9","0xa19ee3966b16ae50ed3f62a5e5ebc7976a38124bbecb7b141629aeeaa338a496":"0x639d9ed7a45ac99b9969f68988211ac89247be923aa0efdf8bacdafb94033c74813ed14da3f5888caac0a0808a6e2eba80c316eacdf46347fbab8aa4647379de536fc3fe45900c48c106aefb6396cc60ea3091c81f02159dfafc32609901e0e50f30668b999d0007290b42e9943e882bd263e8fb2a55862ed60a3fc3309bee70","0xa629750500a13043d42d21d3547e3dae2c52aa27b2afeff506beb6b9d0531be3":"0x3ad713962afa4a1b248ae2e02c852711b8444561f2117ef4475a07751b2e38517106ea2a11bb8b652d2752f0e082f79eefba7d6f33a96f167aaf3a9b8567809174fcd2515b83b341266443a68b31bc1b93722a64b325a56cc1e5b226a450c27918077f900bdd2852cc8ddfedaa5157e22ba5abb1f89336e5047402932cbcd409","0xcf7eb50f106e63e68e218402bab0660df59a8fb272caabc09dd3d7c018bc0a53":"0x3e7b1154acec4770097c4d7e4700ba6629b388ff5bca50540d49308813da5a8f6c7bb76a1affdbd836f855b70cd937742f6e28888452ff380866d15019d754d17b42a747ba704aafc05c0e9c4785ff87904a3965c5ce2b6fb29729e94a67338f661e5355983c301e06d2e5db75c71247ab6448206196d71f48bd79892c222e0e","0xe4a2342131f855a10b344cbed3ea050f429831fd35f6ef89224cd812753bfad2":"0x1291d5ab388ef701fdb40792f7fa878b6debd19a13b3b78c1e9bce05360c679a39f721ec682ea51e699420bc897bea1bfbd7a2c602f5d5bf7e334161e4614aa050bdb3cb447ca3ed237d9a605d6e17f7561a2f9cc69349e481f6a0e407d0c0ab6039506ad41ffb3398531da9d03491ab8870c744140d591b48e9ff750ba64498","0xeedb03fc18a307aae51fa8a53542c5010f215c98d313255fec31ea6c60bf3e7f":"0x1921177f11f2205e677d237b0ac9a77293eabfd3c8d1f94799d5b49949a859c6891081e59c2578f7f42dde8719e0bb24e1629be458601168bc9b4d487eeaba00550b6bea3487afac222a491b688bbcada911bebe98747f55182a6e4cc2dd7c0624ea7a6f7454f49b57e5660fecb1939368dc52f0c703984ee0dde6ec6dbedcc1"}}`
)

type genesisGroup struct {
	GroupInfo model.GroupInfo
	VrfPubkey []vrf.VRFPublicKey
	Pubkeys   []groupsig.Pubkey
}

var genesisGroupInfo []*genesisGroup

//GenerateGenesis
func GetGenesisInfo() []*types.GenesisInfo {
	genesisGroups := getGenesisGroupInfo()
	var genesisInfos = make([]*types.GenesisInfo, 0)
	for _, genesis := range genesisGroups {
		sgi := &genesis.GroupInfo
		coreGroup := convertToGroup(sgi)
		vrfPKs := make([][]byte, sgi.GetMemberCount())
		pks := make([][]byte, sgi.GetMemberCount())

		for i, vpk := range genesis.VrfPubkey {
			vrfPKs[i] = vpk
		}
		for i, vpk := range genesis.Pubkeys {
			pks[i] = vpk.Serialize()
		}
		genesisGroupInfo := &types.GenesisInfo{Group: *coreGroup, VrfPKs: vrfPKs, Pks: pks}
		genesisInfos = append(genesisInfos, genesisGroupInfo)
	}
	return genesisInfos
}

//生成创世组成员信息
//BeginGenesisGroupMember
func (p *groupCreateProcessor) BeginGenesisGroupMember() {
	genesisGroups := getGenesisGroupInfo()
	joinedGroups := genGenesisJoinedGroup()
	for _, genesis := range genesisGroups {
		if !genesis.GroupInfo.MemExist(p.minerInfo.ID) {
			continue
		}

		joinedGroup := joinedGroups[genesis.GroupInfo.GroupID.GetHexString()]
		if joinedGroup == nil {
			continue
		}
		sec := new(groupsig.Seckey)
		sec.SetHexString(common.GlobalConf.GetString("gx", "signSecKey", ""))
		joinedGroup.SignSecKey = *sec

		p.joinedGroupStorage.JoinGroup(joinedGroup, p.minerInfo.ID)
	}

}

func genGenesisJoinedGroup() map[string]*model.JoinedGroupInfo {
	var joinedGroupInfo string
	if common.IsMainnet() {
		joinedGroupInfo = mainNetGenesisJoinedGroup
	} else {
		joinedGroupInfo = robinGenesisJoinedGroup
	}
	splited := strings.Split(joinedGroupInfo, "&&")

	var joinedGroups = make(map[string]*model.JoinedGroupInfo, 0)
	for _, split := range splited {
		joinedGroup := new(model.JoinedGroupInfo)
		err := json.Unmarshal([]byte(split), joinedGroup)
		if err != nil {
			panic(err)
		}
		joinedGroups[joinedGroup.GroupID.GetHexString()] = joinedGroup
	}
	return joinedGroups
}

func getGenesisGroupInfo() []*genesisGroup {
	if genesisGroupInfo == nil {
		genesisGroupInfo = genGenesisGroupInfo()
	}
	return genesisGroupInfo
}

//genGenesisStaticGroupInfo
func genGenesisGroupInfo() []*genesisGroup {
	var genesisGroupInfo string
	if common.IsMainnet() {
		genesisGroupInfo = mainNetGenesisGroup
	} else {
		genesisGroupInfo = robinGenesisGroup
	}
	splited := strings.Split(genesisGroupInfo, "&&")
	var groups = make([]*genesisGroup, 0)
	for _, split := range splited {
		genesis := new(genesisGroup)
		err := json.Unmarshal([]byte(split), genesis)
		if err != nil {
			panic(err)
		}
		group := genesis.GroupInfo
		group.BuildMemberIndex()
		groups = append(groups, genesis)
	}

	return groups
}

//ConvertStaticGroup2CoreGroup
func convertToGroup(groupInfo *model.GroupInfo) *types.Group {
	members := make([][]byte, groupInfo.GetMemberCount())
	for idx, miner := range groupInfo.GroupInitInfo.GroupMembers {
		members[idx] = miner.Serialize()
	}
	return &types.Group{
		Header:    groupInfo.GetGroupHeader(),
		Id:        groupInfo.GroupID.Serialize(),
		PubKey:    groupInfo.GroupPK.Serialize(),
		Signature: groupInfo.GroupInitInfo.ParentGroupSign.Serialize(),
		Members:   members,
	}
}

func readGenesisJoinedGroup(file string, sgi *model.GroupInfo) *model.JoinedGroupInfo {
	data, err := ioutil.ReadFile(file)
	if err != nil {
		panic("read genesis joinedGroup file failed!err=" + err.Error())
	}
	var group = new(model.JoinedGroupInfo)
	err = json.Unmarshal(data, group)
	if err != nil {
		panic(err)
	}
	group.GroupPK = sgi.GroupPK
	group.GroupID = sgi.GroupID
	return group
}
