// Copyright 2020 The RocketProtocol Authors
// This file is part of the RocketProtocol library.
//
// The RocketProtocol library is free software: you can redistribute it and/or modify
// it under the terms of the GNU Lesser General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// The RocketProtocol library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
// GNU Lesser General Public License for more details.
//
// You should have received a copy of the GNU Lesser General Public License
// along with the RocketProtocol library. If not, see <http://www.gnu.org/licenses/>.

package group_create

import (
	"com.tuntun.rocket/node/src/common"
	"com.tuntun.rocket/node/src/consensus/groupsig"
	"com.tuntun.rocket/node/src/consensus/model"
	"com.tuntun.rocket/node/src/consensus/vrf"
	"com.tuntun.rocket/node/src/middleware/types"
	"encoding/json"
	"io/ioutil"
	"strings"
)

const (
	robinGenesisGroup   = `{"GroupInfo":{"GroupID":"0xd588982453c1f6278564b44667573ec3eb6ce326a63e33e89b091cfe3de2a887","GroupPK":"0x608fdd9a055d2e688401220c9e3d0e9c2f26c354b3be07f1a06c4c6d769ae3cd38828f2c7b5b531fff8306a61fbdfa94e5eb59cecff7b28f4abba21f6037a2792d36d3544b2d7057405482a2ebde48f06e302dd1c91fbb6a47d393bb3f19f5660e2909d46e8445f857f1e63dff2bd10913663ca3c8a6bcbc64b0d49d92693251","GroupInitInfo":{"GroupHeader":{"Hash":"0x275d1ec7e591231e9de02a0d29cf465a5dfed5aea15feff938f85714bcc52296","Parent":null,"PreGroup":null,"Authority":777,"Name":"GX genesis group","BeginTime":"2020-12-23T10:31:42.523464+08:00","MemberRoot":"0x519750e82dd561f03eabae5ee7d1f11df0f6c14eb356757ad7bb7de7a51f1448","CreateHeight":0,"ReadyHeight":1,"WorkHeight":0,"DismissHeight":18446744073709551615,"Extends":""},"ParentGroupSign":{},"GroupMembers":["0x5437f9dd7171db9d04a8347dca5bf2b7789081631d79d2d7882c1774d2f4d123","0x2a17671c5a32175335fa098951ba50a9b4730aea7ecee86df6536297900f5b77","0xb1979dd362353f0b59dff76cb223d5660a024db628257693f5470dec18c93160"]},"MemberIndexMap":{"0x2a17671c5a32175335fa098951ba50a9b4730aea7ecee86df6536297900f5b77":1,"0x5437f9dd7171db9d04a8347dca5bf2b7789081631d79d2d7882c1774d2f4d123":0,"0xb1979dd362353f0b59dff76cb223d5660a024db628257693f5470dec18c93160":2},"ParentGroupID":"0x0000000000000000000000000000000000000000000000000000000000000000","PrevGroupID":"0x0000000000000000000000000000000000000000000000000000000000000000"},"VrfPubkey":["JevvUFyYiszl6wg3fPRA1zUBo8TKiphhjJy7Hy0nfcU=","8QZCqd7xDETZ1eA3QaQJUWsAcwYCwrM43UhyLGh9VP4=","mLYbDvkkPQFwnVRZCI59t1iLum4qdMIkEzADhpohvRY="],"Pubkeys":["0x81b7daee9550ac17c0446cb42bcf8cc87155fa36d641320fd351f5cfc5ce435a20457d5f3fe83d79aff4fb2cbcc0812242040d066463998eb5729866f1ce3979671fb242204c961cf2723321729aacbfff2c014f943ab8794785be47319efd76078d7cc657750903e24be9f09685fee361d321963fbc93075b9bdb18dd6f53f1","0x27bfa326a01e6640f61666801a6fc1acc37a18d5d4804c92e304dacef25d606f385fe9f050aeb4d5c9ee4c9d442dd535d65380aa26bfc33d92ab6007b91afdf41ddd68c1c6ab3e11154578eea8a364084fe8e4b263d675dd44ad8be223b75bcc0db0d4cbc4651eb2e5351ab5e01f3d3298227bbe342692582ab5afff39d237b9","0x2ece69e08094f7cdd3f19db009b907225438eea203ac19a27b2c7ac43350569105549567de059c3d247dd2fb9190f77f732d89f84d7540c752b7f837fabad6498c1570d42804397c1beee1876548b0c7abf804076dcfab61511dbd6a84b480230e90cfe8c2fa03e6e997fac2b5507f79eb6a2fdd215cc92bf343b7473b4b4df1"]}`
	mainNetGenesisGroup = `{"GroupInfo":{"GroupID":"0xc18328e9332103883345bf5b179d05057b157c441323d4f37f244410b51315f5","GroupPK":"0x618f1aaaefbfbc86fba968b1c7c20c3850e6fe474ac29e25bbc415c081d25a4a6a35393b4ca3122f327e6e39bab39ec1d8a3830d9151749ff81f833a7fb7527e402161df2c45b8e0ae82362f5f390a1792c24437b57202f3e082f587fd52f24804e9a7dac2be6191a254d48bdfc96b0d1f833bb42492fcf9e06e5fe34149c5d1","GroupInitInfo":{"GroupHeader":{"Hash":"0xa961f7950750d9c5d8901de9ad570ad7b2785af598cc2d8021ac18e50af37c22","Parent":null,"PreGroup":null,"Authority":777,"Name":"Rangers Protocol Genesis Group","BeginTime":"2021-11-30T19:20:12.503988+08:00","MemberRoot":"0xc8eb4fbbabc854c48ce3b25435e4806a27fd5b7d2d501a49fd8e6fbbf8d8c2ff","CreateHeight":0,"ReadyHeight":1,"WorkHeight":0,"DismissHeight":18446744073709551615,"Extends":""},"ParentGroupSign":{},"GroupMembers":["0x03c83f5108783967defbde82296937613549ce914f26b93923f1803caaccc0ff","0xdb010eee578e9efed84a4a17ea7af3152fb14e59c75644b487530d41bb25e918","0x0bbdffba1030f0faac128864261461d48a7fdfdeea58cdf66441e1e183a6768e","0x3013c999b38dc3d54928123090f0d479ba7484b2addd2d9d9abf6734c0f5c4db","0xf7833b11e8cb1cbb54a292e19ca47853f014af7308536b812664dba18bfa9123","0x5f07342021dd46853deed47efea6eece438ef792bae85e528e9cdc7c9196cc65","0x5b5bf1958ad586cf2ec0952b90281030e7c5f4cc60d908aec1be7529350d4850","0x6192be21f2a916d35b377b2dc3997b43d63cab63e3a62b9153033a8178d512cd","0xf60de68bc547c7eb915b2c315a7c61c6027ba7b918a733d8fc685cd53abcf4ec","0x675d0e8edb6620939793c7cc0d8e9c0b905ff8e09b48aac512c2edc2601775cb"]},"MemberIndexMap":{"0x03c83f5108783967defbde82296937613549ce914f26b93923f1803caaccc0ff":0,"0x0bbdffba1030f0faac128864261461d48a7fdfdeea58cdf66441e1e183a6768e":2,"0x3013c999b38dc3d54928123090f0d479ba7484b2addd2d9d9abf6734c0f5c4db":3,"0x5b5bf1958ad586cf2ec0952b90281030e7c5f4cc60d908aec1be7529350d4850":6,"0x5f07342021dd46853deed47efea6eece438ef792bae85e528e9cdc7c9196cc65":5,"0x6192be21f2a916d35b377b2dc3997b43d63cab63e3a62b9153033a8178d512cd":7,"0x675d0e8edb6620939793c7cc0d8e9c0b905ff8e09b48aac512c2edc2601775cb":9,"0xdb010eee578e9efed84a4a17ea7af3152fb14e59c75644b487530d41bb25e918":1,"0xf60de68bc547c7eb915b2c315a7c61c6027ba7b918a733d8fc685cd53abcf4ec":8,"0xf7833b11e8cb1cbb54a292e19ca47853f014af7308536b812664dba18bfa9123":4},"ParentGroupID":"0x0000000000000000000000000000000000000000000000000000000000000000","PrevGroupID":"0x0000000000000000000000000000000000000000000000000000000000000000"},"VrfPubkey":["qoaqfkfBYr0RymqKTWS7MfqOQCmpSTKz8P5DdHVhQ5k=","uiaNRcqwM5LSChvUEdsK6kqI2CACKw91YYlyBbBm784=","q7o1WwB16y76T5gALGB2uGkgNSvM/eYote9aAvmd/CE=","DBrNn+jQCJPhdSHCZsiXsQF8Fgv7eTmu61lQEhU3ycI=","WUWOaLgtwIBmqjEACnKG3xdfEJ+Qd5K+hNErRCtNY6Q=","30z7eIovYjh/Tz9Yvv3PlB9f9Ib+pfYUTMbn2DcW6ck=","x81cFf1nevD/jLwXcI69z6TfyOqA9voqB9kqkZj9sgE=","+V1JwZ0VxgVSff0fyjaCRXyJEmfclXDp/wP9vH5v/mg=","alRLfMTfNFnbbQT80LJ1uh/Jmvh6O/qpexquU/yeF1s=","nRwy61nA+B47a2DZk1DvfOSFtjlw2iXN6Dkhvur0ZFk="],"Pubkeys":["0x378ad0aae9d74c7695521cd0919e2e841e9f9f1bfd81d17f55a6fdb29139e8740005ec137c191d3848a15dc825c3465976da6865b77feab36891c36dfbdff5672c20e801f39558bc60426faafcc23fe565d775655dab6562b51bdc48783d71dd317b16867d198521199fb18c2f8a311c2761d70d75f49ab86f35a466fa0336fe","0x3368e7608db8bcbcd93862bb21c8c8a80c747d85bf9b2dafe395f2cd25b8a5a07f5205ff78a6d98f26f6719d58f15aa625a5406b3ccf910b24a842983bef870779cb6d44414b09e12b462feb882d6e0dfb47d7002ed8336f370253e516cc9e5809cde91fd1a04d82d0ae3032dc02e884d3f20e6e5b02efecb0b58b805986026e","0x8709d54bd53acd68ab450a70a0b20b8a84066f15cc58c902090e693085c8f7e8561a26f7543fcaab0b0944b5ebdb057d24bca423eef4d5ca26e87467834060882107f8313d93467962d7f62666851e96c7c18056fbde6100748ab386125a4a0d22d4463ea38706a81c5bb5505377113bdde84bd30be29e4815ff3c20513f0466","0x1e3038235aeada7391e425e5ae2520f009aa2f634349d697d6046d698602bcbb043db8d14f74fe702276326d3a552f5e6359cfcd365ce05a2071d07a665267f45640ffeafd525a6c438d4132cf3aadb38c8db9615b0f3a31d9d64c556c3b451d472c82f617b796287705d5df58442711da02d11408a2afca4896d1d215285420","0x42ecebaf17e240ca4b412ac8abf8ce1997cd291a6a2a992abff0ed22680eb52b4c66ee72eb563a67680887df195680f4c954e3ecc93ac6a390d14b06f29513f133ccac9cfc6c4370b05aa229e5d1c2c82eed620fd93be346ca79d6bc15675b0f5441843b7e9b54aaea47b21d533d3420b460b56a1470ee178db83f56a7f0da00","0x7ce4a77bf55ef47416094e68a92f1222f8ef1bf55f04a15d4ef08c9c89cf3e502bff3190ca32d204b36d61c9dedbf2dd3139b7a5fdc7be698b248aab34c869bb0b089286dde06540eef6994aafcdea00f53dc971370d2335efe75f598c54217b27807707d7dfab36f949c690a70ba96436d44f587e031def7486c01f9a2f681d","0x70df75b4da4b1d70ecc5daed9cbdb09c86fc6e9d9051b650922f97a67efb242f32fd1d96a82d1e453977e2e778234bc2afcb5fed7aaf94d6065a165f6973f43d78e3dd1bbf9dd64104a47b829365b3e94ea1c16663099f22b0ff49dd8c87585847876f3dfcd9ed7de7974faa3cbba08c918446e3903aba716f2e93967690f86f","0x41d3dd274f3e6e05190b15a944964e40edd0b96cb96b96ce80171da50ae8afd17e779690a9bd4ab161190001535e0acd0080398bac1385075ea594b09c1822598faad04274c1a29f35880fbb1e0c4e70cc457234bfa71d379499e524319977ce556e9100da18db8b37b982f6d561818637f83020e8663094a2fb780ecc07a071","0x4024b8b151c88adcab28cf45f8d565b52993817a2d277845dd72650e4289f9e1886167ef209f97935c4507951899dfbc9ea2e13c77eb2161e2d502a87f6c72643c2c293f4b9d7791eab7f5fea9deed3d5a14a23e24597ec4615a47bbdbbb97a60545580ca4a0fecb77c987178ffbf88f9791df1569e1ba60a720df14b6053ce7","0x8b36219e6039d2fe16112ecb1424f3048897319aa61fb7440cffd3c49bafc354335ca6fad516624dda869bae14cf810e8dfb26d910ed2daad3777ec17841e20b46e3703bdb8833644a22835530d56988a70f96b3554b23ebfb59a5288de181a263686a0b5b9840098847708c16ab487e1f539e6b58c34e045dbc1d30b55ca9f8"]}&&{"GroupInfo":{"GroupID":"0x0a88bd4f855d11c9a6a105c6de5a34e4bde5e5edbffd81210785858c5bc3f342","GroupPK":"0x66df316bb12ccff3906436e62c27c8f6acaf61869f66837449f47e704b08703b0925e5f58e7e92b843b06d18665a8aff49846b82fb5bf61bd1ebddc530fd640b3e130f56265ec8b52695517f301047302d438f0dceb543d226e6436c1300443a6f6a588e586e79a52431337e0537717a38240337056ee755f90c563e3ea38cd0","GroupInitInfo":{"GroupHeader":{"Hash":"0x501ee107889b324eb318b794381f99b44cca0184a4d40f19ec26999321815ba7","Parent":null,"PreGroup":null,"Authority":777,"Name":"Rangers Protocol Genesis Group","BeginTime":"2021-11-30T19:20:59.313964+08:00","MemberRoot":"0x5b03e69e4bd2e3f0f6f7eaf24df521eb66e955deb941ae7f625d3f5de25d31de","CreateHeight":0,"ReadyHeight":1,"WorkHeight":0,"DismissHeight":18446744073709551615,"Extends":""},"ParentGroupSign":{},"GroupMembers":["0xa9237614a7e134456b29c07013aba64de901f5102dc0429b6303988bf5c9a5f2","0xe27de903ed0a463a6cc4af1a32adf1ac4ff7277ce1913346edd5812114d068b5","0x2a326ec7ad47a6b5c57ef59ec95bda13e54cd12bdc308a500e9da751af80d313","0xd6c597a3e377546905a7aa2ee34af508eba0a1aece7cbf723995e4e0c0882bb5","0xa1329d4f7e1878e5bb5c5a31048b88d86f7bc72b8fb3a01b79c70215afe9ff7f","0xc380fff74898c4ea5fd13984d7ee95444764076253c588f4d5d25a8410650927","0x9fe4f4d4d41dc82b604b4b7c44a1e97e080967308168a3cc8a4121261663ac8f","0x7e2ae7a64b2a2550dba7938f7a6a52f179443c0e92a2c19af52d72fec3556de6","0x7705480cd345371172b118b280d2db8864086a617c6d4280d2d58bac3a1b2dc0","0xf4f189c772c32c75c810e22adb17d34793e4f989b4496de8e460a200f7030b02"]},"MemberIndexMap":{"0x2a326ec7ad47a6b5c57ef59ec95bda13e54cd12bdc308a500e9da751af80d313":2,"0x7705480cd345371172b118b280d2db8864086a617c6d4280d2d58bac3a1b2dc0":8,"0x7e2ae7a64b2a2550dba7938f7a6a52f179443c0e92a2c19af52d72fec3556de6":7,"0x9fe4f4d4d41dc82b604b4b7c44a1e97e080967308168a3cc8a4121261663ac8f":6,"0xa1329d4f7e1878e5bb5c5a31048b88d86f7bc72b8fb3a01b79c70215afe9ff7f":4,"0xa9237614a7e134456b29c07013aba64de901f5102dc0429b6303988bf5c9a5f2":0,"0xc380fff74898c4ea5fd13984d7ee95444764076253c588f4d5d25a8410650927":5,"0xd6c597a3e377546905a7aa2ee34af508eba0a1aece7cbf723995e4e0c0882bb5":3,"0xe27de903ed0a463a6cc4af1a32adf1ac4ff7277ce1913346edd5812114d068b5":1,"0xf4f189c772c32c75c810e22adb17d34793e4f989b4496de8e460a200f7030b02":9},"ParentGroupID":"0x0000000000000000000000000000000000000000000000000000000000000000","PrevGroupID":"0x0000000000000000000000000000000000000000000000000000000000000000"},"VrfPubkey":["GxUApvkvaicblTX0FN8/cOZOt0jPEJPxzne46nnOAm4=","AMWnyHhINYhdeC7xJsGhTbnBwq9qpu6irp8kCJm5ODs=","FVXyJUt7hul6cyo09pZyGZMNNaPe9k+sLMMqEP8ri/w=","yeqGemUhVI5yNyhGSdpL+VvbOI7MzL0Af5M1oPglTNg=","wos2v8No9BUg7kDqFVhtOKA6P0VgkxPU8mSCijHOPqA=","I8Jb1s2gqsu7m6wG/FdmO1yBw0wJyqFU8uGWPfMqwOw=","P5MO3NDW7XFPr/57ejrsc1Dj4uvEaMk1Yj30OlHK0GY=","V/JHSBbCEZYCAZw7uw0L6psfP3IvfUwFYrJOwtJPO+g=","/HxVXY6OlLEMFjPASXmXfgXRAhkKnodqVtItp4QYSrY=","zVupxJ9u3TNXQqpswioedwJSk7rjXl9S9B89qfx6WJY="],"Pubkeys":["0x13b45573dd0e58a85d9aeebd1a01b27c7da1760639d108882bec5f2ea644be201203611135660981e760253de1392433b5f4096aa90f86eed876d9dfd8c85cd32a4facd1be32b6f808712822a60e4bc33b2b4d963c2a0da900ad8f14fc74addd40244735dc03bb5081db2c8eba458583f6a15820be81eae43c5a544976d49a97","0x0825769a605c7110c739d453e2cdd5ec1b698ecb796a30a60f9f0a3cc8b631121d3642b64817fc6b0ba494cc5e90220824c7890d6e4219d35383e157690cdcee3031af31b8bfd22ca61cf02565586d444e354775c499ab4cf023aaca7e10a9360a52dcf34954f0e87a113667bbb3dcff471d1726d450bfaf888944353cf39dda","0x83bfe9ca584a714d524c5b025fb3a426910d99d10baef70bc321eaa30424a08f0244d86c7169f71ace5eb6d8b8591cbc16e5ad7465ead2e2de3be21a10a47eca06790992e75ea179d760f164e2e607edbe52ae7f691e1759c4f89858cdbcd54a29698f2c3a412c6be4378cc2516dabbfe873d65c53b4daec1aa060dc017e0091","0x378006e7d307ee518e2238918adce5f31817e47ec2893d9a37fc869e64780d9c333420c45552b714b7506f3449eb62915374efa60d511fd5dea31d5b673895dc6743ef8cd30630ae92c77d315693ba7acf0967c81d01301f1d0077265d12f5950c63ca43a45ca5b10dfd842e5d8d6cd03fa933220ef77a139464c4c1e3ba0af8","0x728744acca22345b87fa8d2f08de395328ebf614208377b87a7c6279cc4fa8e28bedd1d151b9a049d58e6ed4c158a22c5b231e405d97a949a55d9586b05bba828f67c7eb1a90d0d74701bab84db3342a93236de392133374e63a72c56dd532745b7be0be93ac1fb22c5401f4ea319df9a66cfc0c4b1f8ecee64b61880b534687","0x7aa784e2005551c00edcaffe1765dced9ad5a6fcf6bcd4513594e067887e769542ac3e16dacae57e6914cd6e5086753b5110c576d11eb07825bfaea2fe79777d2fa758f795333af7bbca71bf9ced70a0e77cc1d49386f083253226c5b99bc0a960eb35be38093663eef16601e92b08494afe97c1904bcf3ee62d0122a76d863b","0x6d1415e7196a85e84c6e0e51098c7d57f38249bbb88e8ea24374b883f7cf02c27b289bcb48fb246dacc8f598912673ed540ec70fdcea8e122ad0ab075aef024c7f281a912c891376066bbd772d5c1ea0672300694918d98f8df6219edda5d74447f79dfb66c2474ced37e8bcac8dea647b53579eab69ff8c79b05452de56abaf","0x1d0bc942c88293141959b2378fd3754713b3fd8d840ad0f1e3a68036e420df0600bea92e191bb7b7446d6a953a48ad0743693bbe776f2e1e205d169618676a0983c1da3592342fa2e0982ea5573b62e20c4371d0b8e53da73040e3d4a73028781c2dd0eafd0fa185ed9d09ca79657616a173517a871816083691b62ba97edebe","0x317da1fa4e3efeaf8731af822aad6dd51f1f873af5beee56b64973646656cae373ec064ce0fcf03f60f42ed42ddfb02006552d3446bd072f3c8064557a2591cd072e350412916f821150813a03a75edb5466b558a8a501c0df821f5ac413c2d82608308c606a008647aff39476fe8eb4f449168147069d6aaaff902b5b1628e3","0x5dc3af5062ed5dc06a8ddc5b088fbe2ddc0425b96d809c1f7486ecbe4a675e151adb91c7108e0e88dc31aeec7acdd6c85144dece26ed4a3c6be584e3dc6e01f329c5561b2f8e8b24198f4471f54f97569b87523d7acf10133e4f74c0efefbb9b27d548675e9bf9a923ba911c9c6242d703019fea982b32ef42c9160c8296979e"]}`

	robinGenesisJoinedGroup   = `{"GroupHash":"0x275d1ec7e591231e9de02a0d29cf465a5dfed5aea15feff938f85714bcc52296","GroupID":"0xd588982453c1f6278564b44667573ec3eb6ce326a63e33e89b091cfe3de2a887","GroupPK":"0x608fdd9a055d2e688401220c9e3d0e9c2f26c354b3be07f1a06c4c6d769ae3cd38828f2c7b5b531fff8306a61fbdfa94e5eb59cecff7b28f4abba21f6037a2792d36d3544b2d7057405482a2ebde48f06e302dd1c91fbb6a47d393bb3f19f5660e2909d46e8445f857f1e63dff2bd10913663ca3c8a6bcbc64b0d49d92693251","SignSecKey":{},"MemberSignPubkeyMap":{"0x2a17671c5a32175335fa098951ba50a9b4730aea7ecee86df6536297900f5b77":"0x81765735aa48fa38eab581a961630adb459bca8b33a540faed3abaf5baa0a4e44ca776e946ffe9b857421c21062ac3837684b72ef36d174d140f0990972f1da94509dba0edb65dd72b647143776b0d6c25c3a47d0419581d2730bae0e3c0ca34450cfb9346b7fadd6737ffb2d78048ec0360f2a57eb8db870d79d8e51ca31817","0x5437f9dd7171db9d04a8347dca5bf2b7789081631d79d2d7882c1774d2f4d123":"0x6a2a1db50572d6f026ab8274357e961229dbc0dc73e6e5e746fc08237875dffd725bb28a4e4e7e4b5fcc299ab3ff2fb18e64b1822a44b4486b2045d34b5b7e2d8a6a90742f02122be4efd09c6fb454ce606ee80666fd75f792c0e96140bc6b9283b90f32b5916bfa721e18422f5255a73ca9330151367bbc1731ff797a5c7496","0xb1979dd362353f0b59dff76cb223d5660a024db628257693f5470dec18c93160":"0x8cad31d6d8a33b3de6cf964c23aa66e17e56b5aa5914c9d3702871a2e2b41cb63c34a8741ac08ac8d64147b3b72b4ea26f59e6257d26ff59dc0e5088ea0a7e3188d20929c11b012b1e6ed2c2ef4e4b29b9ca6b4e1bd5adff6b899fba6e9df731837b85e47e53969b414839ee28efc4a245e7489726b9c9e5ff2d50fa1e676a4d"}}`
	mainNetGenesisJoinedGroup = `{"GroupHash":"0xa961f7950750d9c5d8901de9ad570ad7b2785af598cc2d8021ac18e50af37c22","GroupID":"0xc18328e9332103883345bf5b179d05057b157c441323d4f37f244410b51315f5","GroupPK":"0x618f1aaaefbfbc86fba968b1c7c20c3850e6fe474ac29e25bbc415c081d25a4a6a35393b4ca3122f327e6e39bab39ec1d8a3830d9151749ff81f833a7fb7527e402161df2c45b8e0ae82362f5f390a1792c24437b57202f3e082f587fd52f24804e9a7dac2be6191a254d48bdfc96b0d1f833bb42492fcf9e06e5fe34149c5d1","SignSecKey":{},"MemberSignPubkeyMap":{"0x03c83f5108783967defbde82296937613549ce914f26b93923f1803caaccc0ff":"0x1b53ae696b891836d783fd918be052cb57b8cf986591108fd189c9742d54029b16ab6c1901d117c3164fe9c30c94315b0b9498629261073c04a60cddde9d967833459659bcbcdc5d5ed679c127e56c23f1e7662f720fd1e157d146540d44e82427a027b358eec2b232b3778d52096ee7d76f0820e4992fa2c638853e0de61a04","0x0bbdffba1030f0faac128864261461d48a7fdfdeea58cdf66441e1e183a6768e":"0x42fb2701a19bfabf431afc83761dc7584e466eef8082af12af7d34787a8b62b228ed0ee03308de9fb677d91fdf15ac2dccbda3aed9a08b8370e21d1f7c20bd6c0c9f4b838a478fe5b5415879247e2981cd58dca2f06b876fdf529a979bba96c26bf47d94ff6faad600a022f3de4680bf22579980eabd576e564c27aa848a683e","0x3013c999b38dc3d54928123090f0d479ba7484b2addd2d9d9abf6734c0f5c4db":"0x2bf8df0f7f0f4498138000a2517be1c79588fc4046753c291efefdbd97a2683833ace3a52e39701833c132e5e102d65811986d3705dbf126dffcdcc1a8384ac61e3bc3af8655f86d1bbe8e3ae5427ef7614770b707b9bfe7250b3e905c8b6b5f3f5367df048dbbca08310f62a1e1a26c9ef3cfea5cad72511abd1191f29d853c","0x5b5bf1958ad586cf2ec0952b90281030e7c5f4cc60d908aec1be7529350d4850":"0x16bd3ce964a71d35534e7da1d6cf269d3a27abd7da3b686ed9234fde5629450b10b00a6fc87c39106afa9a5b6fce14267e0cd6e20f0417c9759fd19a5077c0c25314bde963b8189aa1f1737270d713001c6bfd66210971c62deaaf7017f08fd68ec3e7051fc4e4ac0d46eedbc3a37e9da80fb43fa63afbbdd54bec78af4d9ed6","0x5f07342021dd46853deed47efea6eece438ef792bae85e528e9cdc7c9196cc65":"0x382eca0da5b9f80e80283d7af6d79d9d63637792e143dab4fd2f6ef7fb8ebd551c2bff5c4ef3e7054dff21e505d5ae784ec10df8ca6d70b991cd7c95e31152b9322637a77b6a530e8d5016c3d3feee80e53507e6cfab3bb44a219c39b2f22b188c9fea4bc951cd5f64bf1f8cd7860efb69fb03a0ba4dd69123bfd8653ab59f06","0x6192be21f2a916d35b377b2dc3997b43d63cab63e3a62b9153033a8178d512cd":"0x423f4a911b5e5e0fe7252001c88510d7217e702b77c9808ca0d22779fd6012061f7811e859846f7f675f8d239996f19b37c31eec6202b790984637461b82bdce2009db1804c2e7a44342712eac112ae4efdf1852ab774016b8868ce388e67f84319f3fb9dd470227b0094b7843b324a4df669c7dcfb2f2204076e521af594f79","0x675d0e8edb6620939793c7cc0d8e9c0b905ff8e09b48aac512c2edc2601775cb":"0x21d1d747ce0180d735e1b450b152fc72243b648de590d01a2abe4425dc223f746c51b62bba4741a245125aebf90d4783d7d2a916e4fbf5ff304598f78f26401f5c174763def38e1a5d505f997496a9a1bf57980804b58b4da2e23f7e200f522d4fff2e686ae2e5152b9e1e3e015e17234822a4f0e509dbca2f6dad4565707b5a","0xdb010eee578e9efed84a4a17ea7af3152fb14e59c75644b487530d41bb25e918":"0x264826276c56466fe8d57be37bf572743024e3aa3360c796681d2dc56ca79bf8881b2b881cb1fe08867ad24c591a0643990e9f120c3088def3507ea0d40aa3c75da82df9b5c7f8ba98a4323d270d145a4645a0a9275e4878798d30704a87d86068add501a59673bc586dcfa73709243cb22b3e85e5e1e3fe068c899435092bbf","0xf60de68bc547c7eb915b2c315a7c61c6027ba7b918a733d8fc685cd53abcf4ec":"0x120c1d0b9ec4e98d573f028de1bb47c95ac2ac57415832bee02a1725a24b72557af6528e699afa43aba7dfe9dfed7ffed395b63ccfb9b36927983a055a62280a8686954103025266ef3240e36fe6d37058c5a30636524e712143f41706e555506b0aaadd798dc48d713d3dff4381717b2e4bd4d9bd9cf1a6fb3da8e0d08fb718","0xf7833b11e8cb1cbb54a292e19ca47853f014af7308536b812664dba18bfa9123":"0x2e4347add67d1cf1fa69cbaf146a4985f398920aa0aab712fa597c1d055814818829cfb34eb4ec62adebf167056a76cd7b61af296b6b252d002c290e0531bfeb8bb7aa97258b80da30ecb327817f967c7900b2b2762c51746b211ef6ce961bcf5d13c6d767a44019b57566240926e28dcf20c0adf1513bdd87dbfdead5ea784e"}}&&{"GroupHash":"0x501ee107889b324eb318b794381f99b44cca0184a4d40f19ec26999321815ba7","GroupID":"0x0a88bd4f855d11c9a6a105c6de5a34e4bde5e5edbffd81210785858c5bc3f342","GroupPK":"0x66df316bb12ccff3906436e62c27c8f6acaf61869f66837449f47e704b08703b0925e5f58e7e92b843b06d18665a8aff49846b82fb5bf61bd1ebddc530fd640b3e130f56265ec8b52695517f301047302d438f0dceb543d226e6436c1300443a6f6a588e586e79a52431337e0537717a38240337056ee755f90c563e3ea38cd0","SignSecKey":{},"MemberSignPubkeyMap":{"0x2a326ec7ad47a6b5c57ef59ec95bda13e54cd12bdc308a500e9da751af80d313":"0x149b43c3fe3f55011ecdfbbc7d2e2e8503e7b4acef9708f8cae221904749fb291a6f475c02c8ad65fe319a603ba10d0073aaa6caa7ecb1c0f2ef6bdc52e3f4c1824d722fe444ab8df4e4449f2ebc2a9b549c74412e886d031cde45f8d03744405530052ce15b6185408c4719351633376619d92f35910670728969e5dbd7d9ad","0x7705480cd345371172b118b280d2db8864086a617c6d4280d2d58bac3a1b2dc0":"0x019948a452ec47c77323b726bed88dda4d59e9d0dc9046640156a0c417b2bd700769fd19e317a97e3384363e62dffda6d0a708bb218fa7dfca78ace93e9b866e508c0f267e7751423403a2352036916a3069f93449bb68208b75024d7bd8be715b4ead203f99a734cdb520ec79b3b13061b94bbb66297a836a0301649c85f922","0x7e2ae7a64b2a2550dba7938f7a6a52f179443c0e92a2c19af52d72fec3556de6":"0x469dc4bd2ff4732d99bbe017f9f99ea4a71a389f0fcd4f1edede1f0d679c87434607329d5b2aa407170d1080e519e3a23f369fcff17973059bf21e357f03289b5180bcf3a29438861e6c134d2a1ab37d7d3a8890f78a67da8148109de5c7c1180ad93af0d05e3b7eaa00ceb07c1db0c967a4594d8c6b4a4a90268dd0e855ecce","0x9fe4f4d4d41dc82b604b4b7c44a1e97e080967308168a3cc8a4121261663ac8f":"0x865eef324ed09cc146fbf029d78f8a4ce28cbd17e1d242e494c26efb27e8470d5a3f695716c15663bc0e5430e70fadfce5501451638fcc930681c51eee32099d6637e65503c45c91cb325548331d7602d70a44103ebaf5bfb0157981928158a14cea4bae7f026ea18ab1d792e6c16fb9d86766fb9a64ab66558b4f5c7d52bb1d","0xa1329d4f7e1878e5bb5c5a31048b88d86f7bc72b8fb3a01b79c70215afe9ff7f":"0x5d3c37ca7335b0f2c1ac5c228f6e7974e55ac1da00e6399628d8eb3a90919db174c2bba515a463894b17a8023f3d37ebffb9ab252f290a1bcfe47b946267789d885249942db9d90fbd60635de8c48a58e053b72e7efca02f437ef8e92a64a2e8596678b2dfd7432f81bcdaf4be9b370dda066b2cdd3a7753d0cb6776afc41906","0xa9237614a7e134456b29c07013aba64de901f5102dc0429b6303988bf5c9a5f2":"0x26db74e910d6697fcef26c70ced24d6c3afdeb253a3b69eb0d602a2fb91edc2d0c9738e83d14393dfe2b4ae13b15048a0d709ab4542f006750ab167f9a03d1ae3d2d619820629ce71e2f9b5fd1b213eb7d6bb2d3632c0391a9904ad954dbc6ad1cfa3d670878a86508f6ee175b82b215299a49c4499376602819fb37a0ce5ef8","0xc380fff74898c4ea5fd13984d7ee95444764076253c588f4d5d25a8410650927":"0x8a83df9d5a1de6afa610e44a91d65d4a69360b6a6aa2224bdbec9792e124897c5e7495e69b0c1e600b2a1744b19e430f91f7c8184424c8390e4769b9d15f8ac97509ba4fdbb88b2c3be4e5521d3c26d5ddf9c7cde6050ed15f15df446eab8946346ea869abad8de5658fa2b2f07650e281463ed7443d926fd9cc83f348e8b238","0xd6c597a3e377546905a7aa2ee34af508eba0a1aece7cbf723995e4e0c0882bb5":"0x069fe290437924a46a22394478ab10c4c77026ead32152a32ac624e812f960fc7ca69562296f87f53e1d4bae7de0edffff16272d8292c26d29dc878f9cf383f518d8c5d5484a5df02c98f1954ae743ce0cf7b96885c4dfb0e8fff344c720447f5c811334f3985db4e654d93a0190f4e28ee80f0590340a378ff104f9ad078464","0xe27de903ed0a463a6cc4af1a32adf1ac4ff7277ce1913346edd5812114d068b5":"0x4a4a55724e63ce8ef26e4b6bd31952bf9a445f7ac8930900a35bd8668f53c183479573c249f9fa0bf5969b397e0839f2b545714b26463c2aa31fda40ff125cf33fc68e42154ab08171847853ab42e6402b676d1f38911a49b509929c1fe6fd43193055fed8f2f02b75659cbc2c10d87811f0e69392c52becf9bbacd39cc847b1","0xf4f189c772c32c75c810e22adb17d34793e4f989b4496de8e460a200f7030b02":"0x82735dffd090d891eff0c60482279d6280fa2372f973589bd9baaac46f4fa7de7dc4149405e612af9ebc73bc6786dd0a4c93eb5c380e02064590bbc270741fe769528fd66d4a6c30bd3afae85cfbf0c276c9f477f6a76d5d6e8550b33cac079c1f25c5f0e8c6242e650b61625319d3a312f3c1e08ae1f11b555726518ee0cb86"}}`
)

type genesisGroup struct {
	GroupInfo model.GroupInfo
	VrfPubkey []vrf.VRFPublicKey
	Pubkeys   []groupsig.Pubkey
}

var genesisGroupInfo []*genesisGroup

//GenerateGenesis
func GetGenesisInfo() []*types.GenesisInfo {
	genesisGroups := getGenesisGroupInfo()
	var genesisInfos = make([]*types.GenesisInfo, 0)
	for _, genesis := range genesisGroups {
		sgi := &genesis.GroupInfo
		coreGroup := convertToGroup(sgi)
		vrfPKs := make([][]byte, sgi.GetMemberCount())
		pks := make([][]byte, sgi.GetMemberCount())

		for i, vpk := range genesis.VrfPubkey {
			vrfPKs[i] = vpk
		}
		for i, vpk := range genesis.Pubkeys {
			pks[i] = vpk.Serialize()
		}
		genesisGroupInfo := &types.GenesisInfo{Group: *coreGroup, VrfPKs: vrfPKs, Pks: pks}
		genesisInfos = append(genesisInfos, genesisGroupInfo)
	}
	return genesisInfos
}

//生成创世组成员信息
//BeginGenesisGroupMember
func (p *groupCreateProcessor) BeginGenesisGroupMember() {
	genesisGroups := getGenesisGroupInfo()
	joinedGroups := genGenesisJoinedGroup()
	for _, genesis := range genesisGroups {
		if !genesis.GroupInfo.MemExist(p.minerInfo.ID) {
			continue
		}

		joinedGroup := joinedGroups[genesis.GroupInfo.GroupID.GetHexString()]
		if joinedGroup == nil {
			continue
		}
		sec := new(groupsig.Seckey)
		sec.SetHexString(common.GlobalConf.GetString("gx", "signSecKey", ""))
		joinedGroup.SignSecKey = *sec

		p.joinedGroupStorage.JoinGroup(joinedGroup, p.minerInfo.ID)
	}

}

func genGenesisJoinedGroup() map[string]*model.JoinedGroupInfo {
	var joinedGroupInfo string
	if common.IsMainnet() {
		joinedGroupInfo = mainNetGenesisJoinedGroup
	} else {
		joinedGroupInfo = robinGenesisJoinedGroup
	}
	splited := strings.Split(joinedGroupInfo, "&&")

	var joinedGroups = make(map[string]*model.JoinedGroupInfo, 0)
	for _, split := range splited {
		joinedGroup := new(model.JoinedGroupInfo)
		err := json.Unmarshal([]byte(split), joinedGroup)
		if err != nil {
			panic(err)
		}
		joinedGroups[joinedGroup.GroupID.GetHexString()] = joinedGroup
	}
	return joinedGroups
}

func getGenesisGroupInfo() []*genesisGroup {
	if genesisGroupInfo == nil {
		genesisGroupInfo = genGenesisGroupInfo()
	}
	return genesisGroupInfo
}

//genGenesisStaticGroupInfo
func genGenesisGroupInfo() []*genesisGroup {
	var genesisGroupInfo string
	if common.IsMainnet() {
		genesisGroupInfo = mainNetGenesisGroup
	} else {
		genesisGroupInfo = robinGenesisGroup
	}
	splited := strings.Split(genesisGroupInfo, "&&")
	var groups = make([]*genesisGroup, 0)
	for _, split := range splited {
		genesis := new(genesisGroup)
		err := json.Unmarshal([]byte(split), genesis)
		if err != nil {
			panic(err)
		}
		group := genesis.GroupInfo
		group.BuildMemberIndex()
		groups = append(groups, genesis)
	}

	return groups
}

//ConvertStaticGroup2CoreGroup
func convertToGroup(groupInfo *model.GroupInfo) *types.Group {
	members := make([][]byte, groupInfo.GetMemberCount())
	for idx, miner := range groupInfo.GroupInitInfo.GroupMembers {
		members[idx] = miner.Serialize()
	}
	return &types.Group{
		Header:    groupInfo.GetGroupHeader(),
		Id:        groupInfo.GroupID.Serialize(),
		PubKey:    groupInfo.GroupPK.Serialize(),
		Signature: groupInfo.GroupInitInfo.ParentGroupSign.Serialize(),
		Members:   members,
	}
}

func readGenesisJoinedGroup(file string, sgi *model.GroupInfo) *model.JoinedGroupInfo {
	data, err := ioutil.ReadFile(file)
	if err != nil {
		panic("read genesis joinedGroup file failed!err=" + err.Error())
	}
	var group = new(model.JoinedGroupInfo)
	err = json.Unmarshal(data, group)
	if err != nil {
		panic(err)
	}
	group.GroupPK = sgi.GroupPK
	group.GroupID = sgi.GroupID
	return group
}
