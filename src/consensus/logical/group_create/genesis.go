// Copyright 2020 The RangersProtocol Authors
// This file is part of the RocketProtocol library.
//
// The RangersProtocol library is free software: you can redistribute it and/or modify
// it under the terms of the GNU Lesser General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// The RangersProtocol library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
// GNU Lesser General Public License for more details.
//
// You should have received a copy of the GNU Lesser General Public License
// along with the RocketProtocol library. If not, see <http://www.gnu.org/licenses/>.

package group_create

import (
	"com.tuntun.rocket/node/src/common"
	"com.tuntun.rocket/node/src/consensus/groupsig"
	"com.tuntun.rocket/node/src/consensus/model"
	"com.tuntun.rocket/node/src/consensus/vrf"
	"com.tuntun.rocket/node/src/middleware/types"
	"encoding/json"
	"io/ioutil"
	"strings"
)

const (
	devNetGenesisGroup  = `{"GroupInfo":{"GroupID":"0xd588982453c1f6278564b44667573ec3eb6ce326a63e33e89b091cfe3de2a887","GroupPK":"0x608fdd9a055d2e688401220c9e3d0e9c2f26c354b3be07f1a06c4c6d769ae3cd38828f2c7b5b531fff8306a61fbdfa94e5eb59cecff7b28f4abba21f6037a2792d36d3544b2d7057405482a2ebde48f06e302dd1c91fbb6a47d393bb3f19f5660e2909d46e8445f857f1e63dff2bd10913663ca3c8a6bcbc64b0d49d92693251","GroupInitInfo":{"GroupHeader":{"Hash":"0x275d1ec7e591231e9de02a0d29cf465a5dfed5aea15feff938f85714bcc52296","Parent":null,"PreGroup":null,"Authority":777,"Name":"GX genesis group","BeginTime":"2020-12-23T10:31:42.523464+08:00","MemberRoot":"0x519750e82dd561f03eabae5ee7d1f11df0f6c14eb356757ad7bb7de7a51f1448","CreateHeight":0,"ReadyHeight":1,"WorkHeight":0,"DismissHeight":18446744073709551615,"Extends":""},"ParentGroupSign":{},"GroupMembers":["0x5437f9dd7171db9d04a8347dca5bf2b7789081631d79d2d7882c1774d2f4d123","0x2a17671c5a32175335fa098951ba50a9b4730aea7ecee86df6536297900f5b77","0xb1979dd362353f0b59dff76cb223d5660a024db628257693f5470dec18c93160"]},"MemberIndexMap":{"0x2a17671c5a32175335fa098951ba50a9b4730aea7ecee86df6536297900f5b77":1,"0x5437f9dd7171db9d04a8347dca5bf2b7789081631d79d2d7882c1774d2f4d123":0,"0xb1979dd362353f0b59dff76cb223d5660a024db628257693f5470dec18c93160":2},"ParentGroupID":"0x0000000000000000000000000000000000000000000000000000000000000000","PrevGroupID":"0x0000000000000000000000000000000000000000000000000000000000000000"},"VrfPubkey":["JevvUFyYiszl6wg3fPRA1zUBo8TKiphhjJy7Hy0nfcU=","8QZCqd7xDETZ1eA3QaQJUWsAcwYCwrM43UhyLGh9VP4=","mLYbDvkkPQFwnVRZCI59t1iLum4qdMIkEzADhpohvRY="],"Pubkeys":["0x81b7daee9550ac17c0446cb42bcf8cc87155fa36d641320fd351f5cfc5ce435a20457d5f3fe83d79aff4fb2cbcc0812242040d066463998eb5729866f1ce3979671fb242204c961cf2723321729aacbfff2c014f943ab8794785be47319efd76078d7cc657750903e24be9f09685fee361d321963fbc93075b9bdb18dd6f53f1","0x27bfa326a01e6640f61666801a6fc1acc37a18d5d4804c92e304dacef25d606f385fe9f050aeb4d5c9ee4c9d442dd535d65380aa26bfc33d92ab6007b91afdf41ddd68c1c6ab3e11154578eea8a364084fe8e4b263d675dd44ad8be223b75bcc0db0d4cbc4651eb2e5351ab5e01f3d3298227bbe342692582ab5afff39d237b9","0x2ece69e08094f7cdd3f19db009b907225438eea203ac19a27b2c7ac43350569105549567de059c3d247dd2fb9190f77f732d89f84d7540c752b7f837fabad6498c1570d42804397c1beee1876548b0c7abf804076dcfab61511dbd6a84b480230e90cfe8c2fa03e6e997fac2b5507f79eb6a2fdd215cc92bf343b7473b4b4df1"]}`
	robinGenesisGroup   = `{"GroupInfo":{"GroupID":"0xd588982453c1f6278564b44667573ec3eb6ce326a63e33e89b091cfe3de2a887","GroupPK":"0x608fdd9a055d2e688401220c9e3d0e9c2f26c354b3be07f1a06c4c6d769ae3cd38828f2c7b5b531fff8306a61fbdfa94e5eb59cecff7b28f4abba21f6037a2792d36d3544b2d7057405482a2ebde48f06e302dd1c91fbb6a47d393bb3f19f5660e2909d46e8445f857f1e63dff2bd10913663ca3c8a6bcbc64b0d49d92693251","GroupInitInfo":{"GroupHeader":{"Hash":"0x275d1ec7e591231e9de02a0d29cf465a5dfed5aea15feff938f85714bcc52296","Parent":null,"PreGroup":null,"Authority":777,"Name":"GX genesis group","BeginTime":"2020-12-23T10:31:42.523464+08:00","MemberRoot":"0x519750e82dd561f03eabae5ee7d1f11df0f6c14eb356757ad7bb7de7a51f1448","CreateHeight":0,"ReadyHeight":1,"WorkHeight":0,"DismissHeight":18446744073709551615,"Extends":""},"ParentGroupSign":{},"GroupMembers":["0x5437f9dd7171db9d04a8347dca5bf2b7789081631d79d2d7882c1774d2f4d123","0x2a17671c5a32175335fa098951ba50a9b4730aea7ecee86df6536297900f5b77","0xb1979dd362353f0b59dff76cb223d5660a024db628257693f5470dec18c93160"]},"MemberIndexMap":{"0x2a17671c5a32175335fa098951ba50a9b4730aea7ecee86df6536297900f5b77":1,"0x5437f9dd7171db9d04a8347dca5bf2b7789081631d79d2d7882c1774d2f4d123":0,"0xb1979dd362353f0b59dff76cb223d5660a024db628257693f5470dec18c93160":2},"ParentGroupID":"0x0000000000000000000000000000000000000000000000000000000000000000","PrevGroupID":"0x0000000000000000000000000000000000000000000000000000000000000000"},"VrfPubkey":["JevvUFyYiszl6wg3fPRA1zUBo8TKiphhjJy7Hy0nfcU=","8QZCqd7xDETZ1eA3QaQJUWsAcwYCwrM43UhyLGh9VP4=","mLYbDvkkPQFwnVRZCI59t1iLum4qdMIkEzADhpohvRY="],"Pubkeys":["0x81b7daee9550ac17c0446cb42bcf8cc87155fa36d641320fd351f5cfc5ce435a20457d5f3fe83d79aff4fb2cbcc0812242040d066463998eb5729866f1ce3979671fb242204c961cf2723321729aacbfff2c014f943ab8794785be47319efd76078d7cc657750903e24be9f09685fee361d321963fbc93075b9bdb18dd6f53f1","0x27bfa326a01e6640f61666801a6fc1acc37a18d5d4804c92e304dacef25d606f385fe9f050aeb4d5c9ee4c9d442dd535d65380aa26bfc33d92ab6007b91afdf41ddd68c1c6ab3e11154578eea8a364084fe8e4b263d675dd44ad8be223b75bcc0db0d4cbc4651eb2e5351ab5e01f3d3298227bbe342692582ab5afff39d237b9","0x2ece69e08094f7cdd3f19db009b907225438eea203ac19a27b2c7ac43350569105549567de059c3d247dd2fb9190f77f732d89f84d7540c752b7f837fabad6498c1570d42804397c1beee1876548b0c7abf804076dcfab61511dbd6a84b480230e90cfe8c2fa03e6e997fac2b5507f79eb6a2fdd215cc92bf343b7473b4b4df1"]}`
	mainNetGenesisGroup = `{"GroupInfo":{"GroupID":"0x546fba8c2e6230c670fce6b59e8ae79eab9f6716992f8058d0df058fd256ff40","GroupPK":"0x16c223dc5dddd73e8910bf7bc6068a476c20fba5fd70f894c12305a9129849623352ccfee3b97b1b6b89477ba1511283ca3440c311c3a395349de65d7e21463987919cb908b6cbbd3797f5ff023d7e6bf408368263bc611009241bd4c2f3d80e89a6fe9c564c3bc08ff0838b6108a47bbe03772b4267b6dd7805a8094ecc9c8b","GroupInitInfo":{"GroupHeader":{"Hash":"0x8cc61b35e8710446b73f2fd8701ecd4da14c25835e0842660b94530c65fd2a17","Parent":null,"PreGroup":null,"Authority":777,"Name":"Rangers Protocol Genesis Group","BeginTime":"2021-12-03T17:22:38.140002+08:00","MemberRoot":"0x4d8a00470c8a1ca6359d9811e30059db72dad8d55f21dc457793466d471e1de4","CreateHeight":0,"ReadyHeight":1,"WorkHeight":0,"DismissHeight":18446744073709551615,"Extends":""},"ParentGroupSign":{},"GroupMembers":["0x450233af5bf35351a7f5f75ddc919481f3cbccc5c8acca94f5f655d6481a1637","0x5bcbcbdba33211edd4307c831f97976191dba9ebb74633923ccf2849f5c18308","0x8689719d636a7e945c81f51d7dd061b6dfdf4f1b72e197471c8b0fbfe402f416","0x4e550c28e8ead9f6abd081b5c33a10deeb24c43e821aaba6ea40bf29d83702a9","0x8eb32fa87153b67dfd5981266899a5613b58b054de55c9b986148f83f5305878","0x90e1f3e6aea5e1cdf7882a842dc1582bc100da1ae013a3ec3468ad87e9e66a8d","0x87f5a6225496d8231feb18591c8de325fbfb21d90b78a860997c7f8915990f41","0x2fd9ac354a85b859986fa1efde3f988f7001491e3ee6b367fc4df97c728ece6b","0x529b74731048645faae815b27885e217bd52e4bd51fdb6b3d7de5ef74a2fe037","0x8e83b60d2df2bc07ca68038a44e3b528125001375ecda253847a73d133152eb0","0x5b263345bb4486f8011dc3bab84e85eff520123acaac07c77b9fa1721150a43a","0x627c3cc4f76e396391e6783c46e652df5ee91147c42bc782714182ae0dd3172b","0x5ab27bb391314f4abeb2adc3de5e9230cf3b842f8ce166785a135318e5227f67","0xc8176f7e025e02107dd6a7e6e6b5e8a620f7fa67ad28d071ff0f5cb802ff3f3d","0x043e4eb53148c1ec9f55404a68a73211033b88e313b61a1a2495f2f6bd98d366","0x94e4691eb762a2d0fcfa3874f6d8b62d84842ba153db1e823c5818ad53747cdb","0xa02a92e3cd31c30b98ea81b88a005fc09b401b13f535f5da1d190a659511cc91","0x573510dbd33b211f231dc215ceb100292453db84bfcc1ccb9d66f9cbc63d875e","0x77bf71b9352ef886783bd7a9c0eddc9827c35505c4f792706fb89b6894aefeab","0x0c5a7fd40963705372dd7187c79b4b7645d8df29c39ee2a85c6d5c638b608350"]},"MemberIndexMap":{"0x043e4eb53148c1ec9f55404a68a73211033b88e313b61a1a2495f2f6bd98d366":14,"0x0c5a7fd40963705372dd7187c79b4b7645d8df29c39ee2a85c6d5c638b608350":19,"0x2fd9ac354a85b859986fa1efde3f988f7001491e3ee6b367fc4df97c728ece6b":7,"0x450233af5bf35351a7f5f75ddc919481f3cbccc5c8acca94f5f655d6481a1637":0,"0x4e550c28e8ead9f6abd081b5c33a10deeb24c43e821aaba6ea40bf29d83702a9":3,"0x529b74731048645faae815b27885e217bd52e4bd51fdb6b3d7de5ef74a2fe037":8,"0x573510dbd33b211f231dc215ceb100292453db84bfcc1ccb9d66f9cbc63d875e":17,"0x5ab27bb391314f4abeb2adc3de5e9230cf3b842f8ce166785a135318e5227f67":12,"0x5b263345bb4486f8011dc3bab84e85eff520123acaac07c77b9fa1721150a43a":10,"0x5bcbcbdba33211edd4307c831f97976191dba9ebb74633923ccf2849f5c18308":1,"0x627c3cc4f76e396391e6783c46e652df5ee91147c42bc782714182ae0dd3172b":11,"0x77bf71b9352ef886783bd7a9c0eddc9827c35505c4f792706fb89b6894aefeab":18,"0x8689719d636a7e945c81f51d7dd061b6dfdf4f1b72e197471c8b0fbfe402f416":2,"0x87f5a6225496d8231feb18591c8de325fbfb21d90b78a860997c7f8915990f41":6,"0x8e83b60d2df2bc07ca68038a44e3b528125001375ecda253847a73d133152eb0":9,"0x8eb32fa87153b67dfd5981266899a5613b58b054de55c9b986148f83f5305878":4,"0x90e1f3e6aea5e1cdf7882a842dc1582bc100da1ae013a3ec3468ad87e9e66a8d":5,"0x94e4691eb762a2d0fcfa3874f6d8b62d84842ba153db1e823c5818ad53747cdb":15,"0xa02a92e3cd31c30b98ea81b88a005fc09b401b13f535f5da1d190a659511cc91":16,"0xc8176f7e025e02107dd6a7e6e6b5e8a620f7fa67ad28d071ff0f5cb802ff3f3d":13},"ParentGroupID":"0x0000000000000000000000000000000000000000000000000000000000000000","PrevGroupID":"0x0000000000000000000000000000000000000000000000000000000000000000"},"VrfPubkey":["VI0+o5hwAhI6L8jZs9Dbh+D74QwhnNNJwdZuCRTCFg0=","UAjJ9rCH9xr8qvS6GoJ53IUr8cifTqG9DfYYF11cZ1w=","WEHzNKpWobmLIEcrTxWuYXlWzdJ97UkS7Q017bf4Skw=","8zP55XpPAww1sYzk4pkKapeKkAvYpTwycafpMHt3eos=","jE3YTfVFJjt09ffwR+8ASYWS0AYZh7SKNxYR4qnHYmk=","4+k+hO5B89AxBTNyBIxI/XLJJ/oOWf+ONOtjiCNfgCI=","6VB7gmpW+lLczR2LOjnDqRp4FPpo0Q64Ixl+DJYJzvQ=","gKmmZPcqefncu8z3n4KqigGCkwTBsJlcxhov61TaGow=","eiL1BxPQySdl69uwXf++pcYoG2dtRL27/FtQQCFPu5A=","h/mE5vjUDNY21PkWyAynBNnk1dq2Qacvxv07XfczlJ0=","s3GFHiJneOPvmc8wdzQrh+SwOoea3uLJRN9E6psA9ag=","KpEKIGYbwZ5/4jXV/HoWdBjAjL4SUbFVo9fU9t9X9gM=","4iXSVE8YiR5rKAjRh5uaJv/uPg8RIeuyj/WmkRw0efw=","vNwdr02SylmenL6VWD9N4t9HpsKM0bYYCohQQfpzUc8=","FzsBpNoXfFEcaMPUEiuBtg5mYLrPwoxu36m+jCqGc2U=","4OhliV3XMcfO+9DN4Lf0516bb/MD7GpeJjHgD3wqLBk=","mwXNcNcsBTJqZG+1Bl0quy5/l+9sh2G8bXCu8bAPfcc=","bNbisFMEY6dOuBu6oPZkSVuMr/RoafyX9zivvI+ijHE=","+YHkkpxVpotTY5D4U+BKKqh3d3UH6CUYm18nHl8kjg0=","q7uwofVvDjAGEbrCZj6D4YUz2D+ooeQ2jmIwIq9+mz8="],"Pubkeys":["0x14221fb8822d338728fdc42f032067b6d8dab927de3d03ab97421c2bd6d4c2cf71107e7200cbcd3896347731f7a555e6783f3aaa1854c28e896d5c8c0890e85044d0dec1190b9e4be4b68c0079c50ccbe322fb82cf2ea0749230e668ddf9fdba56ae764cc2be1e00d2717bed3107f830c37b4af5d6215964a555b56904908928","0x058eafd978521289e48a41205aa833c8625aedfdf8ba45db0d20b34f54e102d55d8da1bf8ac1784b33fdad465291aca945b7e1a58e71529a95c118c3c297b3b62aa276dac03710547bc9f21682cc7fca8ae30ec10ecd1a8594abf63e9e521ac31da44e7d376ec21f378f8f3c97d531d3e30c19622833e96ae0824a9f4dde89c5","0x7e14b5772259f5c3f78986054937cf0bd5a35f3c30028f728562d3bf10f9fff6260fa93a98806e19429d1f4b64dd58de24d7c2b847931c2014587e1131b2606f8e7bf6ae3af35f28bff4292fbcdb1eec4215f9c65361f8b1965a70da8d28bf5f2a7e8f8bc077a10d68991ebd58f76b911406c97ce105573470aa79a2ac656aec","0x844e42bc758c340a0de80c89aec0368b5cd02def16bfd26a42e94d61bb8515a6880b505bfe56c1d813b3e07043457af365248a7c68e99e408aae7aedc1f3154b70b6c4503d149dc398fc7f3ae2ac91890e2a580d1f3b39e8aed3edadef46fba618687a058b15e2a4d9a76c202155d3daa0d3379ad70164412e47910881976e37","0x00de4e03947211a923d61a834b3cc56b405739d11daf045f7f6a2f92b458064249786abc2d6c5591b3e989838f81f4a9e386b0f9f643d3d1d7e8c1ddd9f5919f66dcdce30b6e14b219f11ecaf1a916007675275320e390cd22605fef171df2733420db1a73e6c295dd105b4036b5e07b8a7eb776d87335036db3653d133cc018","0x5108c160f30a7f13d4e6e887f9da726770daa22e2e1a826f2165b7f9a38baebf6e4de47dec1b1552ee6568f433f6c9d2cc19f9deac4d5e545c0502ecaef0af992801b3c2582a00d147bcf63346f275062c4232a2331461218631619b1151686d2d23e412c98e444a783a013f817b52387f76077d5cb24e737ce09e2058cf3582","0x6cc71c9a2b568c4617e24f02ecd034af76addaf63131f06443a4c5ef9bee689d88299815191cc3f84b8171e104b08c18971218121f621ebdbb04de62be87f3cd4b190501717ccdedfcc6de9b336475ff2347af9790d9d8b91f7edbbe2df9fe1911678205a7adc8b2a1960856c76aaeec206651e620dfee972005e36f922bcce5","0x08c83aa1c8660dfbf4d0fcdce247b7aeac78785b458290b2207549141370bfa840c459066d9cc3d433edfd0090d3f6fe19b613dc90ae6bb6a6cf752c2e26046922b922d94ca2d97b80540d5559b998930eb79efd9e2f00002c16e71801eef854782e2584d77d33984a23f2f6038c23db28ebbef529355c5ec9135cd4f9e9bfb0","0x86f9d231be933f27855b649373c2af79e539be6d6a0dd45a350f12fae57b3da7359d2638cac7277adcc5ccb33404d84bc1ecc545cb54ff751035bc963f1286b21167eae74cd0a2d2542d9c2b7735d5574c9bd284ae7f65e0c2d93e0e5e735e9d35d93294e2566a552afdde1430d33638172547c019fb8067188f3553df603aa1","0x6fd49f13e637d2fc807468ba97f853e0b119adc5abaf85b97408ba4cbf810d4818c62fb28d09d251ec692c28e9442875b648741f27310b688cfbebbf4cba394e06f541ed1b6d9a25d79f08cfcfe261bb995eb13a34510c0f978efe52b18c1ef40b0d4a3d34c17a8d47b43d4985411b2b15c9fd6407a90cbfa4d1d1c4cb57019f","0x513bf88489551450f93f634b5f2c642ef8f10739fa9d634d1733dfddf556443b6dc935c91a6446a96aa609e9112ef9654425fa2640f81469f7aee12483a1bc566275a16ec52fe8e4cd86df129da9b25daf7668acf9e1f968b9dd1e47d63f6fd5282ffbb7b2126d063a68dfa1fc657fa6973ee77752a21c2aced8eb68113ea412","0x7b8bdf79869f7137add5bc12f6f9c68f87ee6f3fe2bb0a65387027c535acd9ef89a2229278fca8a9b4b83391453209540c6e3e15c96d5de71ad0ee359ec4f6717a8f40fa1bee2a3bafa0d667e8c7de90d1f8be5b0e29a95fc84584da4e5bfeca1b23d2b43cf7c23571b4e7d2b3f65857150513a15b873365d3b22676219f53d8","0x1501935873beb2de9e563e42fdb09368a8fefbb17bd1e40912ceaa42cc1dbbf1366d712b1def3147dd177d2600c8bfc5386cfb45160e64f8093198acd98e398d51c23ab269e99959b6b0498b2f0183e886ae6800001d4e5b9a519e437bdd2cc874f37978cc9f942d72e55cc4d792b80b099a608154af63dbeb010519f047b7d6","0x7401ad03b58f934efdad24716a79fd6b9b9050e197f581ca327837f2a1e925d03392002f3bf3862831bd0d57238b18e52c7893c91c94aa74f29f4acfec0ed93b32cab8928bd28ea0fc4374ab82c260368e3b835283f9e5400fb02a20bc79ee5b6d24d9560ff049dc46ebaba0fa7df622a605bb1162646ba17d59ecfcd4b8679e","0x5595038b537936691be9a24b149467c91233112622b54a403760de940e630a0834f6ba9122d83d406205bc4b28e833db83d5242000e42d9332202ff48def521f71fc1c96570fa234e3ce9765ff4ac91c241f65706b5c72d84f15e0a22979deee1897f0386472a72882fbf3cd842b4c70a4bec36820e28e2b12c544e82b512b5e","0x488acf411d1e636bece8d7761d680b0541da8edeb10889a493fcad546cebc79e669141894588bd208e631332bebf7250adab54e3be3c723272b858b8edef18c4481ace8a21325512852028ba9bdd3c28b9ccbf9c3966aad8d426f3393e0e11880f7f3503839c6b7a291cd34ec404e72047c4c9c3939aadfbd9b25cfa77908c0c","0x38b72c85a9760d8925006a706e8da98694b298ae20c79888a3f27431fcc167ec3be5cd6a07b87ff5d39ca1bc1d33601b5034863dafbcf632224d2c998cdfdf9c5d9184fe444a966c70decf87a4b1e5c582d73d5cef1bbb8c1424964362a2f8ab58b6b053f9b0e1b0f1ced40667f313684cdd63cecd79cad62eb99545e09de223","0x55a149cfb85e767b939f1cbd710e039da99ad8cc2efcab46abe6da252b9204ae6f2da2c058c0c1f236fc2b024c90202eeca617149024ab4dfe7cc3b8d80fcf0a7b9134ac0834b34d514c60a2652ee34f408e4e9e7173e7af1aadb8ac77fa1bdb1ee44e4c245801623dcd81f733c45bfe84128270c064ccc172dc9841ea6a3d6b","0x5f0b4c240b56b1f17948467b4b19418dfc7da075571e11ecccaf1d7a521d7dcf00947c4afb41d8ac5da8041fdfc04787cf07dcb676071e4b4f777e652aa26c171e0193c337ec6a3a05bb7cc6fff677d1a356029595a35ee54c8be40e12eb9f4c5fd42fdd45547501115ac3223db47b35212970c9a7265abc62a0a2b298a50795","0x8273cf5e3b46dc73c6476f91d0d192f95129ad3fb162ec4ebe9e029f901a6a335f572a899ec2efd86898b02ac2168008f8aef22c8b7967f13897fe40a925f8fa8d531022ea817537455b7c7cc50cb0d21e09739e0093790f9fffb101e4a9ed31750bf06a693a702182ed63264e51e121900b68694a054af7fa0eff1e78d10d17"]}`

	devNetGenesisJoinedGroup  = `{"GroupHash":"0x275d1ec7e591231e9de02a0d29cf465a5dfed5aea15feff938f85714bcc52296","GroupID":"0xd588982453c1f6278564b44667573ec3eb6ce326a63e33e89b091cfe3de2a887","GroupPK":"0x608fdd9a055d2e688401220c9e3d0e9c2f26c354b3be07f1a06c4c6d769ae3cd38828f2c7b5b531fff8306a61fbdfa94e5eb59cecff7b28f4abba21f6037a2792d36d3544b2d7057405482a2ebde48f06e302dd1c91fbb6a47d393bb3f19f5660e2909d46e8445f857f1e63dff2bd10913663ca3c8a6bcbc64b0d49d92693251","SignSecKey":{},"MemberSignPubkeyMap":{"0x2a17671c5a32175335fa098951ba50a9b4730aea7ecee86df6536297900f5b77":"0x81765735aa48fa38eab581a961630adb459bca8b33a540faed3abaf5baa0a4e44ca776e946ffe9b857421c21062ac3837684b72ef36d174d140f0990972f1da94509dba0edb65dd72b647143776b0d6c25c3a47d0419581d2730bae0e3c0ca34450cfb9346b7fadd6737ffb2d78048ec0360f2a57eb8db870d79d8e51ca31817","0x5437f9dd7171db9d04a8347dca5bf2b7789081631d79d2d7882c1774d2f4d123":"0x6a2a1db50572d6f026ab8274357e961229dbc0dc73e6e5e746fc08237875dffd725bb28a4e4e7e4b5fcc299ab3ff2fb18e64b1822a44b4486b2045d34b5b7e2d8a6a90742f02122be4efd09c6fb454ce606ee80666fd75f792c0e96140bc6b9283b90f32b5916bfa721e18422f5255a73ca9330151367bbc1731ff797a5c7496","0xb1979dd362353f0b59dff76cb223d5660a024db628257693f5470dec18c93160":"0x8cad31d6d8a33b3de6cf964c23aa66e17e56b5aa5914c9d3702871a2e2b41cb63c34a8741ac08ac8d64147b3b72b4ea26f59e6257d26ff59dc0e5088ea0a7e3188d20929c11b012b1e6ed2c2ef4e4b29b9ca6b4e1bd5adff6b899fba6e9df731837b85e47e53969b414839ee28efc4a245e7489726b9c9e5ff2d50fa1e676a4d"}}`
	robinGenesisJoinedGroup   = `{"GroupHash":"0x275d1ec7e591231e9de02a0d29cf465a5dfed5aea15feff938f85714bcc52296","GroupID":"0xd588982453c1f6278564b44667573ec3eb6ce326a63e33e89b091cfe3de2a887","GroupPK":"0x608fdd9a055d2e688401220c9e3d0e9c2f26c354b3be07f1a06c4c6d769ae3cd38828f2c7b5b531fff8306a61fbdfa94e5eb59cecff7b28f4abba21f6037a2792d36d3544b2d7057405482a2ebde48f06e302dd1c91fbb6a47d393bb3f19f5660e2909d46e8445f857f1e63dff2bd10913663ca3c8a6bcbc64b0d49d92693251","SignSecKey":{},"MemberSignPubkeyMap":{"0x2a17671c5a32175335fa098951ba50a9b4730aea7ecee86df6536297900f5b77":"0x81765735aa48fa38eab581a961630adb459bca8b33a540faed3abaf5baa0a4e44ca776e946ffe9b857421c21062ac3837684b72ef36d174d140f0990972f1da94509dba0edb65dd72b647143776b0d6c25c3a47d0419581d2730bae0e3c0ca34450cfb9346b7fadd6737ffb2d78048ec0360f2a57eb8db870d79d8e51ca31817","0x5437f9dd7171db9d04a8347dca5bf2b7789081631d79d2d7882c1774d2f4d123":"0x6a2a1db50572d6f026ab8274357e961229dbc0dc73e6e5e746fc08237875dffd725bb28a4e4e7e4b5fcc299ab3ff2fb18e64b1822a44b4486b2045d34b5b7e2d8a6a90742f02122be4efd09c6fb454ce606ee80666fd75f792c0e96140bc6b9283b90f32b5916bfa721e18422f5255a73ca9330151367bbc1731ff797a5c7496","0xb1979dd362353f0b59dff76cb223d5660a024db628257693f5470dec18c93160":"0x8cad31d6d8a33b3de6cf964c23aa66e17e56b5aa5914c9d3702871a2e2b41cb63c34a8741ac08ac8d64147b3b72b4ea26f59e6257d26ff59dc0e5088ea0a7e3188d20929c11b012b1e6ed2c2ef4e4b29b9ca6b4e1bd5adff6b899fba6e9df731837b85e47e53969b414839ee28efc4a245e7489726b9c9e5ff2d50fa1e676a4d"}}`
	mainNetGenesisJoinedGroup = `{"GroupHash":"0x8cc61b35e8710446b73f2fd8701ecd4da14c25835e0842660b94530c65fd2a17","GroupID":"0x546fba8c2e6230c670fce6b59e8ae79eab9f6716992f8058d0df058fd256ff40","GroupPK":"0x16c223dc5dddd73e8910bf7bc6068a476c20fba5fd70f894c12305a9129849623352ccfee3b97b1b6b89477ba1511283ca3440c311c3a395349de65d7e21463987919cb908b6cbbd3797f5ff023d7e6bf408368263bc611009241bd4c2f3d80e89a6fe9c564c3bc08ff0838b6108a47bbe03772b4267b6dd7805a8094ecc9c8b","SignSecKey":{},"MemberSignPubkeyMap":{"0x043e4eb53148c1ec9f55404a68a73211033b88e313b61a1a2495f2f6bd98d366":"0x7acd4173841dbc943a9b7eff7539a6e9f232af3e276ece256ff061139bbaeed130c0af7fc2ea478153d3a6178f23fbcbc21940a8c933e84f2ebf90607501c71f71bb3f7afdfa545ae4780d0938cefbccc2e64eb9c9b8a6921e2d66d06da22ee1720571d51743d29cc84000403b59ef2d44cd35454a8ac3951cd18544546c6f23","0x0c5a7fd40963705372dd7187c79b4b7645d8df29c39ee2a85c6d5c638b608350":"0x387bcb30d6c905546e641a2544cd0cf6f61bf88cb6eb038bb64f5f09d897d218428451ff98b05fc16084bae0f1f107e8b49531b640d970204dc91d9ffc22fc740ca3985bc3f804787cc1bf37e0841a05c5c15b9818df4f48385d2b62d8a69cab6f82146daacc22f677bb87e1c486e22873f8fa7cc6335a1aa1d199b24f83af6f","0x2fd9ac354a85b859986fa1efde3f988f7001491e3ee6b367fc4df97c728ece6b":"0x8fb0ac840600fa47b2973caaf76198adc714e93fd04ef1d8f42782dcff3b27140f51b7896f4fb56d071f48901479efc1e808042f9b3c5ec7d6a7954c156605f4312710a63782c6608931c10048bf7303daf1f28e745cc4438a08b21024e9252c2a581c1136446c4915495ae7c7652ddf7c3ba582a55f83629f42d26e1e6ad630","0x450233af5bf35351a7f5f75ddc919481f3cbccc5c8acca94f5f655d6481a1637":"0x6ecdc6eae1b70f575a4f2b5be2707c0b73b3cbf5dbd8025ac59f03ccbe82ae760efc1bc020371dee8edb746793d793dd35197d099b75bae1619c763a35995e006ee37fe3ae14783341df01369abfe1eceb49201b5a5a66c0ecbb56655a1e7d668f328c5624d3ddd2509469587be76edcad63410b109c3c5b669477b202cde07d","0x4e550c28e8ead9f6abd081b5c33a10deeb24c43e821aaba6ea40bf29d83702a9":"0x3002c73456a667a344f9c7223a574b58bb0a10adbca1a147c8be3b58d6adca00798a099287a330de65f6236bae59e490209d0097ae9dc81118d807572d9152de6689a8eef9d7e84035251df4f54f5fcc708d174d1c3af259d802698254abbbdb85786608c445de4042a8b36079fc9483ba89ab7af954b5d370e9e2069f43387f","0x529b74731048645faae815b27885e217bd52e4bd51fdb6b3d7de5ef74a2fe037":"0x8dfc7e85d1e871aea73374d4c6b635e0a3c4a37e9d9cfbaf292ff1c35d18eb9e509c1a476f989aa3e9d1bac6a9bf34208363e2b8ed06950ae9bc788f469d4ccc5ec686c003cd7e7389c49555cb4ed308f0462c4131e58df87837b274e2bfdc1f0d481aa4e31bc9eee47ce0d913805c23186a151280f3586a1c83e82e03d6e815","0x573510dbd33b211f231dc215ceb100292453db84bfcc1ccb9d66f9cbc63d875e":"0x89242a7142328a6843d52155f3de9ea669acd28d86e1fa9ae2b17dcba291d2288d6c21ff3d871b26621355691bcaef4a4cbc7b4eba6fc55cde3806ed0eadc677018b805e3211e8398c116ec81f6ae9c7bd5ec99f8468232cf22c02fddca2c2227964d874ea1f88a8addbd651c399bd4c772e143a23ca008948f5578b3055ec86","0x5ab27bb391314f4abeb2adc3de5e9230cf3b842f8ce166785a135318e5227f67":"0x6e1ffaf57d3670345506b42e4a084524d1b52bc320e7bdb21ec7f25d9d1090684c3a13141234c02f35a82087e169f1bc377538e6b6e4b8de62dc276d9806513f52caf19d079a31fae7fb9030be5d8d88426b1a71cfcf028969e71f8815790e59464725e44dfa4f303ffce4d1014658cc5ff7e82661f7d76e8bf286024d71e441","0x5b263345bb4486f8011dc3bab84e85eff520123acaac07c77b9fa1721150a43a":"0x471efad7bd216c098ac8dc54b8bb98e9a6acb07fea2b3280e4a3574e6a5af7d678676b541e19124a8ac1231a93e8fb0a3f8cebfe5d4a44bdae8cfb9a69c5216f6672404106a467b6c58aea35133f8a41496642d91069453df690271575ddf5467d7ab35a657637f40919b5431c15f5ee9b9019ccfbf83d3178480d34bd846cda","0x5bcbcbdba33211edd4307c831f97976191dba9ebb74633923ccf2849f5c18308":"0x8eb9dcec73dcf7ccaf7eecbe43c024035f4f5ca7ae9729cb750479650fc526f2142d6c4dcab5a99e37e0223936a44cfdc0d5bef96d635701baebb6fe7f7749dd202280ead9ae883501f00700f554cb5b7297164d871fe7b3accfb4e551362057880ac94934a1e8aa061bc9110da13ba1293b428f4f0918ab28e3fa71cb2a7c75","0x627c3cc4f76e396391e6783c46e652df5ee91147c42bc782714182ae0dd3172b":"0x7eed6957d83038f74db62f07477dee7f7de1fe3a4b3a9c9204815121858b19975b6b8b641620251aead14c038475eec44ee196209d8d030246a37c4a3125c5862a393a9753b814c4c12663dcc9746d8577ae54868c083479b09658f177b72f495cc3fab36a6f9708077b4382c42e601369f4298a908b715d1c52a1942337ec16","0x77bf71b9352ef886783bd7a9c0eddc9827c35505c4f792706fb89b6894aefeab":"0x58805c563506cd4732b17eea2bf6f5aed7cd043e8513720322dc1829f45fdcd289ba53bb297ed9231dceed108843c45daf5bb5360126679e39d50d387f937e8f4e47390bb66f928126e858c8c06a080e7f32a7061add37ed91bd574f5a2e7a1e3000f32af843d662d11bcce710f50c0c380c3da9c24c643351c7d7095df0143e","0x8689719d636a7e945c81f51d7dd061b6dfdf4f1b72e197471c8b0fbfe402f416":"0x2bcc94f6cc89a0f2407db7643539d86fa5e98cc36d3f8340085b0bd93b549668623a8c8d62d26c557a90d00cef6ddccef19dcc6e99664c6514658cb284affa3d8bf499b4ce790fcab533c90d6f1879e912b543e063896dc06ffbfc77d277c00a15578c003515b703ea6f099e6162c547b42eb8ed43da6ccac5dad9ea7f247808","0x87f5a6225496d8231feb18591c8de325fbfb21d90b78a860997c7f8915990f41":"0x1d742a84d3360f0c931d1973315d2ff38698a8e34c7c5b670f4a0637b403de2b6337bf9ba4cd168caa11a5f13f0aca1f23d3575d99b46a4665c5ac96147c47da092a532894f89841d919c3cd6d21db29d6f358dceeccb36c8f2a74ba930fe831220956dbd26c771cc72bf50e30ea9a309c8e0126638d39b51021ad5f4b8321a9","0x8e83b60d2df2bc07ca68038a44e3b528125001375ecda253847a73d133152eb0":"0x4b8f304e7d601ef6a03be02c6b96128457070a15d51fcbe4be16e195344f304e5d6a4b19d5aea736469014302bb61895c6e35dd84484d1d9c432416dee341b6366b485c3d59b9cf03100d87b654ef14526689d27cf194a195a326cbecc65bd2f030e94dfb774ce62353b56a0367397dd0ef4e79e65ab99a447a61fe29d91f7a6","0x8eb32fa87153b67dfd5981266899a5613b58b054de55c9b986148f83f5305878":"0x61677bce44195e639453aeed439362817c8731f8e268772e7de394f28df92d6089789be07dc77347eae8c99ff9c627a1cc8ce79bb711a71770f9f36da2aec0f23c97645aa0847052c800e1db2a49e18ea55e52e9d5422b0ca58ffce96968c0d41973a77f80e47b6afc769600fcecdfae12e79bc5e718a379e889f10edf81126a","0x90e1f3e6aea5e1cdf7882a842dc1582bc100da1ae013a3ec3468ad87e9e66a8d":"0x18a75896808caecd79c020f2f234e0d777f7d8706d9081b132852d839821379452ee5118477ff5f2c8b4bd6ecc635c058530ee36e6fde6f73dff40fbb834fcf31601d38d8d9ddebec7aa17170e43ece8e3ce708d882e16e2c4c4ba2bf3e9e117507be10c3a50fd52ad230bac8602f45d7404dec086dec39cba818d71b91682cf","0x94e4691eb762a2d0fcfa3874f6d8b62d84842ba153db1e823c5818ad53747cdb":"0x21c602e590d9e2953d350acf8cf93a23e67cb65413cb140259fd617a3e5b84651764c832dc4a0abb8527283987dbe219b8df5871325f3bde85c71f7ea452425b2d0a92d6461652d23d1dd34c26339fd0cf44002252f20ee7caf63dbf6dd6da0a504dd20a8108fb36de87ce7b8b18143c528e309306f8fa45f56b8b5c9b4b2d7c","0xa02a92e3cd31c30b98ea81b88a005fc09b401b13f535f5da1d190a659511cc91":"0x6dc1daca7864a3047092021f5bde7b6727ecbdd063f236204ae458c4d9759e88793bb2666722f36f16f321d8cfdb46121602c336e20fc1ef6ce09699509013903b92441c650cafc44dee7cde27bdee6121ea9371414d93d57f8a2fd9b88ed2ab2d99b9b6f3de8a51a2d11d4733816f2549fe636547b05eee1384400aaf1ef839","0xc8176f7e025e02107dd6a7e6e6b5e8a620f7fa67ad28d071ff0f5cb802ff3f3d":"0x6ccc9b428295e129eca4c25a838c59467a906f389fd3339907940214142de21500129814757b7ec40a30c9a6cd11c1e7ea15d8191b42f818cb76374b969cda5a051cc5fc8cb4f675f27bb59700c5528eb5ca3f594dda36ee5f5c699619a923c175b696bde33c53125d08a24b7eed805550ec1978ef3b98a482328315ede52073"}}`
)

type genesisGroup struct {
	GroupInfo model.GroupInfo
	VrfPubkey []vrf.VRFPublicKey
	Pubkeys   []groupsig.Pubkey
}

var genesisGroupInfo []*genesisGroup

func GetGenesisInfo() []*types.GenesisInfo {
	genesisGroups := getGenesisGroupInfo()
	var genesisInfos = make([]*types.GenesisInfo, 0)
	for _, genesis := range genesisGroups {
		sgi := &genesis.GroupInfo
		coreGroup := convertToGroup(sgi)
		vrfPKs := make([][]byte, sgi.GetMemberCount())
		pks := make([][]byte, sgi.GetMemberCount())

		for i, vpk := range genesis.VrfPubkey {
			vrfPKs[i] = vpk
		}
		for i, vpk := range genesis.Pubkeys {
			pks[i] = vpk.Serialize()
		}
		genesisGroupInfo := &types.GenesisInfo{Group: *coreGroup, VrfPKs: vrfPKs, Pks: pks}
		genesisInfos = append(genesisInfos, genesisGroupInfo)
	}
	return genesisInfos
}

func (p *groupCreateProcessor) BeginGenesisGroupMember() {
	genesisGroups := getGenesisGroupInfo()
	joinedGroups := genGenesisJoinedGroup()
	for _, genesis := range genesisGroups {
		if !genesis.GroupInfo.MemExist(p.minerInfo.ID) {
			continue
		}

		joinedGroup := joinedGroups[genesis.GroupInfo.GroupID.GetHexString()]
		if joinedGroup == nil {
			continue
		}
		sec := new(groupsig.Seckey)
		sec.SetHexString(common.GlobalConf.GetString("gx", "signSecKey", ""))
		joinedGroup.SignSecKey = *sec

		p.joinedGroupStorage.JoinGroup(joinedGroup, p.minerInfo.ID)
	}

}

func genGenesisJoinedGroup() map[string]*model.JoinedGroupInfo {
	var joinedGroupInfo string
	if nil != common.Genesis {
		joinedGroupInfo = common.Genesis.JoinedGroup
	} else {
		if common.IsMainnet() {
			joinedGroupInfo = mainNetGenesisJoinedGroup
		} else if common.IsDEV() {
			joinedGroupInfo = devNetGenesisJoinedGroup
		} else {
			joinedGroupInfo = robinGenesisJoinedGroup
		}

	}

	splited := strings.Split(joinedGroupInfo, "&&")

	var joinedGroups = make(map[string]*model.JoinedGroupInfo, 0)
	for _, split := range splited {
		joinedGroup := new(model.JoinedGroupInfo)
		err := json.Unmarshal([]byte(split), joinedGroup)
		if err != nil {
			panic(err)
		}
		joinedGroups[joinedGroup.GroupID.GetHexString()] = joinedGroup
	}
	return joinedGroups
}

func getGenesisGroupInfo() []*genesisGroup {
	if genesisGroupInfo == nil {
		genesisGroupInfo = genGenesisGroupInfo()
	}
	return genesisGroupInfo
}

// genGenesisStaticGroupInfo
func genGenesisGroupInfo() []*genesisGroup {
	var genesisGroupInfo string
	if nil != common.Genesis {
		genesisGroupInfo = common.Genesis.Group
	} else {
		if common.IsMainnet() {
			genesisGroupInfo = mainNetGenesisGroup
		} else if common.IsDEV() {
			genesisGroupInfo = devNetGenesisGroup
		} else {
			genesisGroupInfo = robinGenesisGroup
		}
	}

	splited := strings.Split(genesisGroupInfo, "&&")
	var groups = make([]*genesisGroup, 0)
	for _, split := range splited {
		genesis := new(genesisGroup)
		err := json.Unmarshal([]byte(split), genesis)
		if err != nil {
			panic(err)
		}
		group := genesis.GroupInfo
		group.BuildMemberIndex()
		groups = append(groups, genesis)
	}

	return groups
}

// ConvertStaticGroup2CoreGroup
func convertToGroup(groupInfo *model.GroupInfo) *types.Group {
	members := make([][]byte, groupInfo.GetMemberCount())
	for idx, miner := range groupInfo.GroupInitInfo.GroupMembers {
		members[idx] = miner.Serialize()
	}
	return &types.Group{
		Header:    groupInfo.GetGroupHeader(),
		Id:        groupInfo.GroupID.Serialize(),
		PubKey:    groupInfo.GroupPK.Serialize(),
		Signature: groupInfo.GroupInitInfo.ParentGroupSign.Serialize(),
		Members:   members,
	}
}

func readGenesisJoinedGroup(file string, sgi *model.GroupInfo) *model.JoinedGroupInfo {
	data, err := ioutil.ReadFile(file)
	if err != nil {
		panic("read genesis joinedGroup file failed!err=" + err.Error())
	}
	var group = new(model.JoinedGroupInfo)
	err = json.Unmarshal(data, group)
	if err != nil {
		panic(err)
	}
	group.GroupPK = sgi.GroupPK
	group.GroupID = sgi.GroupID
	return group
}
