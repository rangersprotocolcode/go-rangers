package vm

import (
	"com.tuntun.rocket/node/src/common"
	"com.tuntun.rocket/node/src/middleware/log"
	"com.tuntun.rocket/node/src/vm/crypto"
	"fmt"
	"github.com/holiman/uint256"
	"math/big"
	"testing"
)

func TestVM0(t *testing.T) {
	mockInit()
	config := new(testConfig)
	setDefaults(config)
	defer log.Close()

	config.GasLimit = 3000000
	config.GasPrice = big.NewInt(0)

	contractCodeBytes := common.Hex2Bytes("60806040526000805534801561001457600080fd5b5060ca806100236000396000f3fe6080604052348015600f57600080fd5b506004361060325760003560e01c80632beaa90f14603757806387db03b7146053575b600080fd5b603d607e565b6040518082815260200191505060405180910390f35b607c60048036036020811015606757600080fd5b81019080803590602001909291905050506087565b005b60008054905090565b80600054016000819055505056fea265627a7a72315820dd06e5c6466fd6226b1d4db2bfa83033ef4a09278a8cd2f8efde275770f29e8a64736f6c63430005110032")
	createResult, contractAddress, createLeftGas, createErr := mockCreate(contractCodeBytes, config)
	fmt.Printf("New create contract address:%s\n", contractAddress.GetHexString())
	fmt.Printf("New create contract createResult:%v\n", createResult)
	fmt.Printf("New create contract createLeftGas:%v,createErr:%v\n", createLeftGas, createErr)

	//invoke add
	input := common.Hex2Bytes("87db03b70000000000000000000000000000000000000000000000000000000000000003")
	callResult, callLeftGas, callErr := mockCall(contractAddress, input, config)
	fmt.Printf("callResult:%v,callLeftGas:%v,callErr:%v\n", callResult, callLeftGas, callErr)

	//invoke get
	input = common.Hex2Bytes("2beaa90f")
	callResult, callLeftGas, callErr = mockCall(contractAddress, input, config)
	fmt.Printf("callResult:%v,callLeftGas:%v,callErr:%v\n", callResult, callLeftGas, callErr)
	//stateDB := config.State
}

func TestVM1(t *testing.T) {
	mockInit()
	config := new(testConfig)
	setDefaults(config)
	defer log.Close()

	config.GasLimit = 3000000
	config.GasPrice = big.NewInt(1)

	contractCodeBytes := common.Hex2Bytes("60806040526000805534801561001457600080fd5b50610283806100246000396000f3fe608060405234801561001057600080fd5b50600436106100575760003560e01c80630d56562c1461005c5780632beaa90f146100a05780635b3357d2146100be5780636271f50e146100dc578063d4b6f21c14610128575b600080fd5b61009e6004803603602081101561007257600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610146565b005b6100a861018a565b6040518082815260200191505060405180910390f35b6100c6610193565b6040518082815260200191505060405180910390f35b610126600480360360808110156100f257600080fd5b81019080803590602001909291908035906020019092919080359060200190929190803590602001909291905050506101d4565b005b61013061020d565b6040518082815260200191505060405180910390f35b80600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b60008054905090565b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1631905090565b836000540160008190555082600054036000819055508160005402600081905550806000548161020057fe5b0560008190555050505050565b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163190509056fea265627a7a72315820d99c4e269ce7a3842ef1d4ed91588b73c5883a822de11215136baf18c0761dcc64736f6c63430005110032")
	createResult, contractAddress, createLeftGas, createErr := mockCreate(contractCodeBytes, config)
	fmt.Printf("New create contract address:%s\n", contractAddress.GetHexString())
	fmt.Printf("New create contract createResult:%v,%d\n", createResult, len(createResult))
	fmt.Printf("New create contract costGas:%v,createErr:%v\n", config.GasLimit-createLeftGas, createErr)

	input := common.Hex2Bytes("6271f50e000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000002")
	callResult, callLeftGas, callErr := mockCall(contractAddress, input, config)
	fmt.Printf("callResult:%v,costGas:%d,callErr:%v\n", callResult, config.GasLimit-callLeftGas, callErr)
}

func TestVM2(t *testing.T) {
	mockInit()
	config := new(testConfig)
	setDefaults(config)
	defer log.Close()

	config.GasLimit = 3000000
	config.GasPrice = big.NewInt(1)

	contractCodeBytes := common.Hex2Bytes("60806040526000805534801561001457600080fd5b50610283806100246000396000f3fe608060405234801561001057600080fd5b50600436106100575760003560e01c80630d56562c1461005c5780632beaa90f146100a05780635b3357d2146100be5780636271f50e146100dc578063d4b6f21c14610128575b600080fd5b61009e6004803603602081101561007257600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610146565b005b6100a861018a565b6040518082815260200191505060405180910390f35b6100c6610193565b6040518082815260200191505060405180910390f35b610126600480360360808110156100f257600080fd5b81019080803590602001909291908035906020019092919080359060200190929190803590602001909291905050506101d4565b005b61013061020d565b6040518082815260200191505060405180910390f35b80600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b60008054905090565b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1631905090565b836000540160008190555082600054036000819055508160005402600081905550806000548161020057fe5b0560008190555050505050565b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163190509056fea265627a7a72315820d99c4e269ce7a3842ef1d4ed91588b73c5883a822de11215136baf18c0761dcc64736f6c63430005110032")
	createResult, contractAddress, createLeftGas, createErr := mockCreate(contractCodeBytes, config)
	fmt.Printf("New create contract address:%s\n", contractAddress.GetHexString())
	fmt.Printf("New create contract createResult:%v,%d\n", createResult, len(createResult))
	fmt.Printf("New create contract costGas:%v,createErr:%v\n", config.GasLimit-createLeftGas, createErr)

	input := common.Hex2Bytes("0d56562c000000000000000000000000f89eebcc07e820f5a8330f52111fa51dd9dfb925")
	callResult, callLeftGas, callErr := mockCall(contractAddress, input, config)
	fmt.Printf("callResult:%v,costGas:%d,callErr:%v\n", callResult, config.GasLimit-callLeftGas, callErr)

	stateDB := config.State
	addr := common.HexToAddress("0xf89eebcc07e820f5a8330f52111fa51dd9dfb925")
	stateDB.SetBalance(addr, big.NewInt(5))

	input2 := common.Hex2Bytes("5b3357d2")
	callResult2, callLeftGas2, callErr2 := mockCall(contractAddress, input2, config)
	fmt.Printf("callResult:%v,costGas:%d,callErr:%v\n", callResult2, config.GasLimit-callLeftGas2, callErr2)

	input3 := common.Hex2Bytes("d4b6f21c")
	callResult3, callLeftGas3, callErr3 := mockCall(contractAddress, input3, config)
	fmt.Printf("callResult:%v,costGas:%d,callErr:%v\n", callResult3, config.GasLimit-callLeftGas3, callErr3)

}

func TestVM3(t *testing.T) {
	mockInit()
	config := new(testConfig)
	setDefaults(config)
	defer log.Close()

	config.GasLimit = 3000000
	config.GasPrice = big.NewInt(1)

	contractCodeBytes := common.Hex2Bytes("60806040526000805534801561001457600080fd5b50610393806100246000396000f3fe608060405234801561001057600080fd5b50600436106100625760003560e01c80630d56562c146100675780632beaa90f146100ab5780635b3357d2146100c95780636271f50e146100e7578063c667a2f314610133578063d4b6f21c146101fc575b600080fd5b6100a96004803603602081101561007d57600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919050505061021a565b005b6100b361025e565b6040518082815260200191505060405180910390f35b6100d1610267565b6040518082815260200191505060405180910390f35b610131600480360360808110156100fd57600080fd5b81019080803590602001909291908035906020019092919080359060200190929190803590602001909291905050506102a8565b005b6101e260048036036101c081101561014a57600080fd5b8101908080359060200190929190803590602001909291908035906020019092919080359060200190929190803590602001909291908035906020019092919080359060200190929190803590602001909291908035906020019092919080359060200190929190803590602001909291908035906020019092919080359060200190929190803590602001909291905050506102e1565b604051808215151515815260200191505060405180910390f35b61020461031d565b6040518082815260200191505060405180910390f35b80600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b60008054905090565b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1631905090565b83600054016000819055508260005403600081905550816000540260008190555080600054816102d457fe5b0560008190555050505050565b60008b9c50899a508798508596508394508192508d8f1115610306576001905061030b565b600090505b9e9d5050505050505050505050505050565b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163190509056fea265627a7a72315820c86eab4397d623e08f37b570d296bd75678ba8161e97d34122d738bb0e76dd3464736f6c63430005110032")
	createResult, contractAddress, createLeftGas, createErr := mockCreate(contractCodeBytes, config)
	fmt.Printf("New create contract address:%s\n", contractAddress.GetHexString())
	fmt.Printf("New create contract createResult:%v,%d\n", createResult, len(createResult))
	fmt.Printf("New create contract costGas:%v,createErr:%v\n", config.GasLimit-createLeftGas, createErr)

	input := common.Hex2Bytes("c667a2f3000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000009000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000b000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000d000000000000000000000000000000000000000000000000000000000000000e")
	callResult, callLeftGas, callErr := mockCall(contractAddress, input, config)
	fmt.Printf("callResult:%v,costGas:%d,callErr:%v\n", callResult, config.GasLimit-callLeftGas, callErr)
}

func TestVM4(t *testing.T) {
	mockInit()
	config := new(testConfig)
	setDefaults(config)
	defer log.Close()

	config.GasLimit = 3000000
	config.GasPrice = big.NewInt(1)

	contractCodeBytes := common.Hex2Bytes("6080604052735c602ec7b8de713d6106da7d1db1fd7bfcc2d4d46000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055503480156200006557600080fd5b5060405162001c9938038062001c9983398181016040526200008b9190810190620000f2565b600060028190555080600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550506200016c565b600081519050620000ec8162000152565b92915050565b6000602082840312156200010557600080fd5b60006200011584828501620000db565b91505092915050565b60006200012b8262000132565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6200015d816200011e565b81146200016957600080fd5b50565b611b1d806200017c6000396000f3fe6080604052600436106100555760003560e01c8063046b290814610057578063999635a11461006e578063ad88be6e14610097578063b2b57a26146100c0578063da68b4b4146100e9578063eb185c50146100f3575b005b34801561006357600080fd5b5061006c61010f565b005b34801561007a57600080fd5b5061009560048036036100909190810190611327565b61014a565b005b3480156100a357600080fd5b506100be60048036036100b9919081019061123e565b610369565b005b3480156100cc57600080fd5b506100e760048036036100e29190810190611327565b61055c565b005b6100f161074e565b005b61010d600480360361010891908101906111fd565b610796565b005b7f8a75e65e6a8c5a0bc5c906bb7fc1f38cdbdfc0adc92e41b43b3ce83463a8a8c06002546040516101409190611754565b60405180910390a1565b846001600254011461015b57600080fd5b600084511161016957600080fd5b835183511461017757600080fd5b835182511461018557600080fd5b606060008090505b85518110156101c85760606101b5838884815181106101a857fe5b60200260200101516107e1565b905080925050808060010191505061018d565b506060868286866040516020016101e2949392919061160d565b6040516020818303038152906040529050600081805190602001209050610209818561092a565b61021557505050610362565b60008090505b87518110156103125786818151811061023057fe5b602002602001015173ffffffffffffffffffffffffffffffffffffffff166108fc87838151811061025d57fe5b60200260200101519081150290604051600060405180830381858888f19350505050158015610290573d6000803e3d6000fd5b507fe04d47d3054af1f047151ee17798cebe92f604635034315e4fcab7b2d7a66ef98882815181106102be57fe5b60200260200101518883815181106102d257fe5b60200260200101518884815181106102e657fe5b60200260200101516040516102fd93929190611716565b60405180910390a1808060010191505061021b565b506002600081548092919060010191905055507f8a75e65e6a8c5a0bc5c906bb7fc1f38cdbdfc0adc92e41b43b3ce83463a8a8c06002546040516103569190611754565b60405180910390a15050505b5050505050565b856001600254011461037a57600080fd5b600084511161038857600080fd5b835183511461039657600080fd5b83518251146103a457600080fd5b606060008090505b85518110156103e75760606103d4838884815181106103c757fe5b60200260200101516107e1565b90508092505080806001019150506103ac565b50606087828686604051602001610401949392919061160d565b6040516020818303038152906040529050600081805190602001209050610428818561092a565b61043457505050610554565b60008090505b8751811015610504578873ffffffffffffffffffffffffffffffffffffffff1663a9059cbb88838151811061046b57fe5b602002602001015188848151811061047f57fe5b60200260200101516040518363ffffffff1660e01b81526004016104a492919061166a565b602060405180830381600087803b1580156104be57600080fd5b505af11580156104d2573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506104f691908101906111d4565b50808060010191505061043a565b506002600081548092919060010191905055507f8a75e65e6a8c5a0bc5c906bb7fc1f38cdbdfc0adc92e41b43b3ce83463a8a8c06002546040516105489190611754565b60405180910390a15050505b505050505050565b846001600254011461056d57600080fd5b600084511161057b57600080fd5b835183511461058957600080fd5b835182511461059757600080fd5b606060008090505b85518110156105da5760606105c7838884815181106105ba57fe5b60200260200101516107e1565b905080925050808060010191505061059f565b506060868286866040516020016105f4949392919061160d565b604051602081830303815290604052905060008180519060200120905061061b818561092a565b61062757505050610747565b60008090505b87518110156106f7576000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663a9059cbb88838151811061067f57fe5b602002602001015188848151811061069357fe5b60200260200101516040518363ffffffff1660e01b81526004016106b892919061166a565b600060405180830381600087803b1580156106d257600080fd5b505af11580156106e6573d6000803e3d6000fd5b50505050808060010191505061062d565b506002600081548092919060010191905055507f8a75e65e6a8c5a0bc5c906bb7fc1f38cdbdfc0adc92e41b43b3ce83463a8a8c060025460405161073b9190611754565b60405180910390a15050505b5050505050565b6000341161075b57600080fd5b7fb61b60bb8d6b946262c1546b50b6e216393eb147c9d267ea7d123d9aafd5483a333460405161078c92919061166a565b60405180910390a1565b600034116107a357600080fd5b7f6cf43ed1a9dd396df89c54be8a0dacaf939f1afdc5dc17a37974d01665ad2d478133346040516107d6939291906116d8565b60405180910390a150565b6060808390506060839050606081518351016040519080825280601f01601f1916602001820160405280156108255781602001600182028038833980820191505090505b5090506060819050600080905060008090505b85518110156108a65785818151811061084d57fe5b602001015160f81c60f81b83838060010194508151811061086a57fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508080600101915050610838565b5060008090505b845181101561091b578481815181106108c257fe5b602001015160f81c60f81b8383806001019450815181106108df57fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535080806001019150506108ad565b50829550505050505092915050565b6000610934610da0565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166309a9d76c6040518163ffffffff1660e01b815260040160606040518083038186803b15801561099c57600080fd5b505afa1580156109b0573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506109d491908101906111ab565b90507fe821288434e942492293d0b381bb8e705c32fa88ff6a7978ea1a399fde4a7e6d81600060038110610a0457fe5b6020020151604051610a16919061164f565b60405180910390a16000809050610a2b610dc2565b60008090505b8551811015610b45576000610a5988888481518110610a4c57fe5b6020026020010151610b68565b9050600080905060008090505b83811015610ac8578273ffffffffffffffffffffffffffffffffffffffff16858260048110610a9157fe5b602002015173ffffffffffffffffffffffffffffffffffffffff161415610abb5760019150610ac8565b8080600101915050610a66565b506001811415610ad9575050610b38565b81848460048110610ae657fe5b602002019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff1681525050610b278683610bd9565b15610b355784806001019550505b50505b8080600101915050610a31565b5060028210610b5a5760019350505050610b62565b600093505050505b92915050565b600080610b80610b7b8460006020610c51565b610d05565b90506000610b98610b9385602080610c51565b610d05565b90506000610ba98560406001610c51565b600081518110610bb557fe5b602001015160f81c60f81b9050610bce86848484610d13565b935050505092915050565b600080600090505b6004811015610c45578273ffffffffffffffffffffffffffffffffffffffff16848260038110610c0d57fe5b602002015173ffffffffffffffffffffffffffffffffffffffff161415610c38576001915050610c4b565b8080600101915050610be1565b50600090505b92915050565b606080826040519080825280601f01601f191660200182016040528015610c875781602001600182028038833980820191505090505b50905060008090505b83811015610cf9578585820181518110610ca657fe5b602001015160f81c60f81b828281518110610cbd57fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508080600101915050610c90565b50809150509392505050565b600060208201519050919050565b6000808260f81c905060008360f81c60ff161480610d37575060018360f81c60ff16145b15610d4657601b8360f81c0190505b60018682878760405160008152602001604052604051610d699493929190611693565b6020604051602081039080840390855afa158015610d8b573d6000803e3d6000fd5b50505060206040510351915050949350505050565b6040518060600160405280600390602082028038833980820191505090505090565b6040518060800160405280600490602082028038833980820191505090505090565b600081359050610df381611a7e565b92915050565b600081519050610e0881611a7e565b92915050565b600081359050610e1d81611a95565b92915050565b600082601f830112610e3457600080fd5b6003610e47610e428261179c565b61176f565b91508183856020840282011115610e5d57600080fd5b60005b83811015610e8d5781610e738882610df9565b845260208401935060208301925050600181019050610e60565b5050505092915050565b600082601f830112610ea857600080fd5b8135610ebb610eb6826117be565b61176f565b91508181835260208401935060208101905083856020840282011115610ee057600080fd5b60005b83811015610f105781610ef68882610e0e565b845260208401935060208301925050600181019050610ee3565b5050505092915050565b600082601f830112610f2b57600080fd5b8135610f3e610f39826117e6565b61176f565b9150818183526020840193506020810190508360005b83811015610f845781358601610f6a888261109a565b845260208401935060208301925050600181019050610f54565b5050505092915050565b600082601f830112610f9f57600080fd5b8135610fb2610fad8261180e565b61176f565b9150818183526020840193506020810190508360005b83811015610ff85781358601610fde88826110ee565b845260208401935060208301925050600181019050610fc8565b5050505092915050565b600082601f83011261101357600080fd5b813561102661102182611836565b61176f565b9150818183526020840193506020810190508385602084028201111561104b57600080fd5b60005b8381101561107b57816110618882611196565b84526020840193506020830192505060018101905061104e565b5050505092915050565b60008151905061109481611aac565b92915050565b600082601f8301126110ab57600080fd5b81356110be6110b98261185e565b61176f565b915080825260208301602083018583830111156110da57600080fd5b6110e5838284611a21565b50505092915050565b600082601f8301126110ff57600080fd5b813561111261110d8261188a565b61176f565b9150808252602083016020830185838301111561112e57600080fd5b611139838284611a21565b50505092915050565b600082601f83011261115357600080fd5b8135611166611161826118b6565b61176f565b9150808252602083016020830185838301111561118257600080fd5b61118d838284611a21565b50505092915050565b6000813590506111a581611ac3565b92915050565b6000606082840312156111bd57600080fd5b60006111cb84828501610e23565b91505092915050565b6000602082840312156111e657600080fd5b60006111f484828501611085565b91505092915050565b60006020828403121561120f57600080fd5b600082013567ffffffffffffffff81111561122957600080fd5b61123584828501611142565b91505092915050565b60008060008060008060c0878903121561125757600080fd5b600061126589828a01611196565b965050602061127689828a01610de4565b955050604087013567ffffffffffffffff81111561129357600080fd5b61129f89828a01610f8e565b945050606087013567ffffffffffffffff8111156112bc57600080fd5b6112c889828a01610e97565b935050608087013567ffffffffffffffff8111156112e557600080fd5b6112f189828a01611002565b92505060a087013567ffffffffffffffff81111561130e57600080fd5b61131a89828a01610f1a565b9150509295509295509295565b600080600080600060a0868803121561133f57600080fd5b600061134d88828901611196565b955050602086013567ffffffffffffffff81111561136a57600080fd5b61137688828901610f8e565b945050604086013567ffffffffffffffff81111561139357600080fd5b61139f88828901610e97565b935050606086013567ffffffffffffffff8111156113bc57600080fd5b6113c888828901611002565b925050608086013567ffffffffffffffff8111156113e557600080fd5b6113f188828901610f1a565b9150509295509295909350565b600061140a838361143d565b60208301905092915050565b600061142283836115d8565b60208301905092915050565b611437816119eb565b82525050565b6114468161198c565b82525050565b6114558161197a565b82525050565b600061146682611902565b6114708185611948565b935061147b836118e2565b8060005b838110156114ac57815161149388826113fe565b975061149e8361192e565b92505060018101905061147f565b5085935050505092915050565b60006114c48261190d565b6114ce8185611953565b93506114d9836118f2565b8060005b8381101561150a5781516114f18882611416565b97506114fc8361193b565b9250506001810190506114dd565b5085935050505092915050565b611520816119aa565b82525050565b600061153182611923565b61153b818561195e565b935061154b818560208601611a30565b61155481611a6d565b840191505092915050565b600061156a82611923565b611574818561196f565b9350611584818560208601611a30565b80840191505092915050565b600061159b82611918565b6115a5818561195e565b93506115b5818560208601611a30565b6115be81611a6d565b840191505092915050565b6115d2816119d4565b82525050565b6115e1816119d4565b82525050565b6115f86115f3826119d4565b611a63565b82525050565b611607816119de565b82525050565b600061161982876115e7565b602082019150611629828661155f565b9150611635828561145b565b915061164182846114b9565b915081905095945050505050565b6000602082019050611664600083018461144c565b92915050565b600060408201905061167f600083018561142e565b61168c60208301846115c9565b9392505050565b60006080820190506116a86000830187611517565b6116b560208301866115fe565b6116c26040830185611517565b6116cf6060830184611517565b95945050505050565b600060608201905081810360008301526116f28186611526565b9050611701602083018561142e565b61170e60408301846115c9565b949350505050565b600060608201905081810360008301526117308186611590565b905061173f602083018561142e565b61174c60408301846115c9565b949350505050565b600060208201905061176960008301846115c9565b92915050565b6000604051905081810181811067ffffffffffffffff8211171561179257600080fd5b8060405250919050565b600067ffffffffffffffff8211156117b357600080fd5b602082029050919050565b600067ffffffffffffffff8211156117d557600080fd5b602082029050602081019050919050565b600067ffffffffffffffff8211156117fd57600080fd5b602082029050602081019050919050565b600067ffffffffffffffff82111561182557600080fd5b602082029050602081019050919050565b600067ffffffffffffffff82111561184d57600080fd5b602082029050602081019050919050565b600067ffffffffffffffff82111561187557600080fd5b601f19601f8301169050602081019050919050565b600067ffffffffffffffff8211156118a157600080fd5b601f19601f8301169050602081019050919050565b600067ffffffffffffffff8211156118cd57600080fd5b601f19601f8301169050602081019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b600081519050919050565b600081519050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b6000602082019050919050565b600081905092915050565b600081905092915050565b600082825260208201905092915050565b600081905092915050565b6000611985826119b4565b9050919050565b6000611997826119b4565b9050919050565b60008115159050919050565b6000819050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600060ff82169050919050565b60006119f6826119fd565b9050919050565b6000611a0882611a0f565b9050919050565b6000611a1a826119b4565b9050919050565b82818337600083830152505050565b60005b83811015611a4e578082015181840152602081019050611a33565b83811115611a5d576000848401525b50505050565b6000819050919050565b6000601f19601f8301169050919050565b611a878161197a565b8114611a9257600080fd5b50565b611a9e8161198c565b8114611aa957600080fd5b50565b611ab58161199e565b8114611ac057600080fd5b50565b611acc816119d4565b8114611ad757600080fd5b5056fea365627a7a723158207a4a6d7944acd950c4876c6760d5b0fe976a7e962ad8d98f66f589a2afa5eb806c6578706572696d656e74616cf564736f6c63430005110040000000000000000000000000253D2C464d6c0bF52e7ea5E798B87912d99303bd")
	createResult, contractAddress, createLeftGas, createErr := mockCreate(contractCodeBytes, config)
	fmt.Printf("New create contract address:%s\n", contractAddress.GetHexString())
	fmt.Printf("New create contract createResult:%v,%d\n", createResult, len(createResult))
	fmt.Printf("New create contract costGas:%v,createErr:%v\n", config.GasLimit-createLeftGas, createErr)
	//-------------------CALL 1----------------
	input := common.Hex2Bytes("da68b4b4")

	stateDB := config.State
	addr := common.HexToAddress("0x0f656deb14f9666d3fdf9dff7c1c430c0570223f10900c89c94a79324ad24085")
	stateDB.SetBalance(addr, big.NewInt(5))

	config.Value = big.NewInt(1)
	config.Origin = addr
	callResult, callLeftGas, callErr := mockCall(contractAddress, input, config)
	fmt.Printf("callResult:%v,costGas:%d,callErr:%v\n", callResult, config.GasLimit-callLeftGas, callErr)
	//-------CALL 2 ---------------------
	input2 := common.Hex2Bytes("eb185c50000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000056162636465000000000000000000000000000000000000000000000000000000")

	addr = common.HexToAddress("0x0f656deb14f9666d3fdf9dff7c1c430c0570223f10900c89c94a79324ad24084")
	stateDB.SetBalance(addr, big.NewInt(5))

	config.Value = big.NewInt(2)
	config.Origin = addr
	callResult2, callLeftGas2, callErr2 := mockCall(contractAddress, input2, config)
	fmt.Printf("callResult:%v,costGas:%d,callErr:%v\n", callResult2, config.GasLimit-callLeftGas2, callErr2)
}

func TestVM5(t *testing.T) {
	mockInit()
	config := new(testConfig)
	setDefaults(config)
	defer log.Close()

	config.GasLimit = 3000000
	config.GasPrice = big.NewInt(1)

	contractCodeBytes := common.Hex2Bytes("608060405234801561001057600080fd5b50610223806100206000396000f3fe608060405234801561001057600080fd5b506004361061002b5760003560e01c80639db8d7d514610030575b600080fd5b61005c6004803603602081101561004657600080fd5b810190808035906020019092919050505061005e565b005b60606040518060200161007090610106565b6020820181038252601f19601f820116604052509050600081518381602085016000f59150507fb03c53b28e78a88e31607a27e1fa48234dce28d5d9d9ec7b295aeb02e674a1e18184604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a1505050565b60e5806101138339019056fe6080604052736a47c06bcfabc079e4c3b196a47f3b5a2fa998b96000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555073ead5853f4d54d0718c568a589f0087c5eb385645600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600060025534801560bd57600080fd5b50600160025401600281905550600073ffffffffffffffffffffffffffffffffffffffff16fffea165627a7a72305820819896a9eac1488592d8328ef846692c4cb6c760d247250e56013d5ca20d6e760029")
	createResult, contractAddress, createLeftGas, createErr := mockCreate(contractCodeBytes, config)
	fmt.Printf("New create contract address:%s\n", contractAddress.GetHexString())
	fmt.Printf("New create contract createResult:%v,%d\n", createResult, len(createResult))
	fmt.Printf("New create contract costGas:%v,createErr:%v\n", config.GasLimit-createLeftGas, createErr)

	input := common.Hex2Bytes("9db8d7d50000000000000000000000000000000000000000000000000000000000000001")
	callResult, callLeftGas, callErr := mockCall(contractAddress, input, config)
	fmt.Printf("callResult:%v,costGas:%d,callErr:%v\n", callResult, config.GasLimit-callLeftGas, callErr)
}

func TestCreate2Address(t *testing.T) {
	salt := uint256.NewInt()
	salt.SetUint64(1)

	addr := common.HexToAddress("0x616fe1518d70c3d3a4d10c89005f29db05979b31000000000000000000000000")

	code := common.Hex2Bytes("6080604052736a47c06bcfabc079e4c3b196a47f3b5a2fa998b96000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555073ead5853f4d54d0718c568a589f0087c5eb385645600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600060025534801560bd57600080fd5b50600160025401600281905550600073ffffffffffffffffffffffffffffffffffffffff16fffe")
	codeAndHash := &codeAndHash{code: code}

	fmt.Printf("code:%v\n", codeAndHash.Hash().Bytes())
	fmt.Printf("addr:%v\n", addr.Bytes())
	fmt.Printf("salt:%v\n", salt.Bytes32())
	contractAddr := crypto.CreateAddress2(addr, common.Hash(salt.Bytes32()), codeAndHash.Hash().Bytes())
	fmt.Printf("create2 contract addr:%v", contractAddr.Bytes())
}

func TestVM6(t *testing.T) {
	mockInit()
	config := new(testConfig)
	setDefaults(config)
	defer log.Close()

	config.GasLimit = 3000000
	config.GasPrice = big.NewInt(1)

	contractCodeBytes := common.Hex2Bytes("6080604052348015600f57600080fd5b506103ac8061001f6000396000f3fe608060405234801561001057600080fd5b506004361061002b5760003560e01c8063f8a8fd6d14610030575b600080fd5b610038610052565b604051808215151515815260200191505060405180910390f35b600080600360050690507f3a406d3871dab9676f7dbfa824f81f599698603527e1521006603c9118171e18816040518082815260200191505060405180910390a16000600460050790507f3a406d3871dab9676f7dbfa824f81f599698603527e1521006603c9118171e18816040518082815260200191505060405180910390a1600081831390507f3a406d3871dab9676f7dbfa824f81f599698603527e1521006603c9118171e18816040518082815260200191505060405180910390a160008060011890507f3a406d3871dab9676f7dbfa824f81f599698603527e1521006603c9118171e18816040518082815260200191505060405180910390a160003090507fe821288434e942492293d0b381bb8e705c32fa88ff6a7978ea1a399fde4a7e6d81604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390a160003290507f3a406d3871dab9676f7dbfa824f81f599698603527e1521006603c9118171e18816040518082815260200191505060405180910390a160003a90507f3a406d3871dab9676f7dbfa824f81f599698603527e1521006603c9118171e18816040518082815260200191505060405180910390a16000600140905060004190507f3a406d3871dab9676f7dbfa824f81f599698603527e1521006603c9118171e18816040518082815260200191505060405180910390a160004390507f3a406d3871dab9676f7dbfa824f81f599698603527e1521006603c9118171e18816040518082815260200191505060405180910390a160004290507f3a406d3871dab9676f7dbfa824f81f599698603527e1521006603c9118171e18816040518082815260200191505060405180910390a160004490507f3a406d3871dab9676f7dbfa824f81f599698603527e1521006603c9118171e18816040518082815260200191505060405180910390a160004590507f3a406d3871dab9676f7dbfa824f81f599698603527e1521006603c9118171e18816040518082815260200191505060405180910390a160019d50505050505050505050505050509056fea265627a7a723158208f072ad16ca9bcf60e7483559e58f66b1dd625c0eb10201e3846e1c9dbdd62e064736f6c63430005110032")
	createResult, contractAddress, createLeftGas, createErr := mockCreate(contractCodeBytes, config)
	fmt.Printf("New create contract address:%s\n", contractAddress.GetHexString())
	fmt.Printf("New create contract createResult:%v,%d\n", createResult, len(createResult))
	fmt.Printf("New create contract costGas:%v,createErr:%v\n", config.GasLimit-createLeftGas, createErr)

	input := common.Hex2Bytes("f8a8fd6d")
	callResult, callLeftGas, callErr := mockCall(contractAddress, input, config)
	fmt.Printf("callResult:%v,costGas:%d,callErr:%v\n", callResult, config.GasLimit-callLeftGas, callErr)
}

func TestVM7(t *testing.T) {
	mockInit()
	config := new(testConfig)
	setDefaults(config)
	defer log.Close()

	config.GasLimit = 3000000
	config.GasPrice = big.NewInt(1)

	contractCodeBytes := common.Hex2Bytes("606060409081526002805460a060020a60ff02191690556101c090519081016040908152603c82526078602083015261012c9082015261025860608201526107086080820152610e1060a0820152611c2060c082015261384060e082015261708061010082015261e100610120820152620151806101408201526202a3006101608201526205460061018082015262093a806101a0820152620000a790600390600e6200055b565b5060408051908101604052600d81527f43727970746f4b697474696573000000000000000000000000000000000000006020820152600a908051620000f1929160200190620005fe565b5060408051908101604052600281527f434b0000000000000000000000000000000000000000000000000000000000006020820152600b9080516200013b929160200190620005fe565b5066038d7ea4c68000600c5561138860105561c350601155662386f26fc100006012556201518060135534156200017157600080fd5b6002805460008054600160a060020a033316600160a060020a03199182168117835560a060020a60ff0219909316740100000000000000000000000000000000000000001716909117909155620001dc9080806000198164010000000062002429620001e382021704565b506200075e565b6000620001ef6200067f565b600063ffffffff8811156200020357600080fd5b63ffffffff8711156200021557600080fd5b61ffff8611156200022557600080fd5b61010060405190810160409081528682526001604060020a0342166020830152600090820181905263ffffffff808b1660608401528916608083015260a0820181905260c082015261ffff871660e082015260058054919350600191808301620002908382620006c3565b6000928352602090922085916002020181518155602082015160018201805467ffffffffffffffff19166001604060020a039290921691909117905560408201518160010160086101000a8154816001604060020a0302191690836001604060020a0316021790555060608201518160010160106101000a81548163ffffffff021916908363ffffffff16021790555060808201518160010160146101000a81548163ffffffff021916908363ffffffff16021790555060a08201518160010160186101000a81548163ffffffff021916908363ffffffff16021790555060c082015181600101601c6101000a81548161ffff021916908361ffff16021790555060e08201516001909101805461ffff929092167e0100000000000000000000000000000000000000000000000000000000000002600160f060020a039092169190911790555003905063ffffffff811115620003ec57600080fd5b83600160a060020a03167f0a5311bd2a6608f08a180df2ee7c5946819a649b204b554bb8e39825b2c50ad582846060015163ffffffff16856080015163ffffffff1686516040518085815260200184815260200183815260200182815260200194505050505060405180910390a26200047660008583640100000000620020da6200048182021704565b979650505050505050565b600160a060020a03808316600081815260076020908152604080832080546001019055858352600690915290208054600160a060020a03191690911790558316156200051557600160a060020a03831660009081526007602090815260408083208054600019019055838352600982528083208054600160a060020a03199081169091556008909252909120805490911690555b8082600160a060020a031684600160a060020a03167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60405160405180910390a4505050565b600283019183908215620005ec5791602002820160005b83821115620005b857835183826101000a81548163ffffffff021916908363ffffffff160217905550926020019260040160208160030104928301926001030262000572565b8015620005ea5782816101000a81549063ffffffff0219169055600401602081600301049283019260010302620005b8565b505b50620005fa929150620006f7565b5090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200064157805160ff191683800117855562000671565b8280016001018555821562000671579182015b828111156200067157825182559160200191906001019062000654565b50620005fa9291506200071e565b6101006040519081016040908152600080835260208301819052908201819052606082018190526080820181905260a0820181905260c0820181905260e082015290565b815481835581811511620006f257600202816002028360005260206000209182019101620006f291906200073b565b505050565b6200071b91905b80821115620005fa57805463ffffffff19168155600101620006fe565b90565b6200071b91905b80821115620005fa576000815560010162000725565b6200071b91905b80821115620005fa576000808255600182015560020162000742565b612ab5806200076e6000396000f30060606040526004361061028f5763ffffffff60e060020a600035041663030c474181146102c75780630519ce79146102e957806305e455461461031857806306fdde031461033d578063095ea7b3146103c75780630a0f8168146103e95780631051db34146103fc57806314001f4c1461042357806318160ddd1461044257806321717ebf1461045557806323b872dd1461046857806324e7a38a1461049057806327d7874c146104af5780632ba73c15146104ce5780633d7d3f5a146104ed5780633f4ba83a1461050c578063404d0e3e1461051f57806346116e6f1461053257806346d22c70146105485780634707f44f14610561578063481af3d3146105835780634ad8c938146105995780634b85fd55146105b85780634dfff04f146105ce5780634e0a3379146105f0578063561291341461060f5780635c975abb146106315780635fd8c710146106445780636352211e146106575780636af04a571461066d5780636fbde40d146106805780637004fb841461069f57806370a08231146106b857806371587988146106d75780638456cb59146106f657806388c2a0bf1461070957806391876e571461071f57806395d89b41146107325780639d6fac6f14610745578063a45f4bfc14610774578063a9059cbb1461078a578063ae4d0ff7146107ac578063b047fb50146107bf578063b0c35c05146107d2578063b5319335146107e5578063b6a324e014610407578063c3bea9af146107f8578063c8241ba61461080e578063d3e6f49f1461082d578063d95660be14610843578063e6cbe35114610856578063e98b7f4d14610869578063eb845c17146108d7578063ed60ade6146108ea578063f1ca9410146108f8578063f2b47d521461090b578063f7d8c8831461091e575b600e5433600160a060020a03908116911614806102ba5750600f5433600160a060020a039081169116145b15156102c557600080fd5b005b34156102d257600080fd5b6102c5600435600160a060020a036024351661092c565b34156102f457600080fd5b6102fc610982565b604051600160a060020a03909116815260200160405180910390f35b341561032357600080fd5b61032b610991565b60405190815260200160405180910390f35b341561034857600080fd5b610350610997565b60405160208082528190810183818151815260200191508051906020019080838360005b8381101561038c578082015183820152602001610374565b50505050905090810190601f1680156103b95780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156103d257600080fd5b6102c5600160a060020a0360043516602435610a35565b34156103f457600080fd5b6102fc610ab0565b341561040757600080fd5b61040f610abf565b604051901515815260200160405180910390f35b341561042e57600080fd5b6102c5600160a060020a0360043516610ac5565b341561044d57600080fd5b61032b610b72565b341561046057600080fd5b6102fc610b7c565b341561047357600080fd5b6102c5600160a060020a0360043581169060243516604435610b8b565b341561049b57600080fd5b6102c5600160a060020a0360043516610bdc565b34156104ba57600080fd5b6102c5600160a060020a0360043516610c89565b34156104d957600080fd5b6102c5600160a060020a0360043516610cdb565b34156104f857600080fd5b6102c5600435602435604435606435610d2d565b341561051757600080fd5b6102c5610df9565b341561052a57600080fd5b61032b610e91565b341561053d57600080fd5b6102fc600435610e97565b341561055357600080fd5b61040f600435602435610eb2565b341561056c57600080fd5b61032b600160a060020a0360043516602435610f34565b341561058e57600080fd5b6102fc600435610f8e565b34156105a457600080fd5b6102c5600435602435604435606435610fa9565b34156105c357600080fd5b6102c560043561106f565b34156105d957600080fd5b6102c5600160a060020a036004351660243561108f565b34156105fb57600080fd5b6102c5600160a060020a03600435166110e9565b341561061a57600080fd5b6102c5600435600160a060020a036024351661113b565b341561063c57600080fd5b61040f6111b7565b341561064f57600080fd5b6102c56111c7565b341561066257600080fd5b6102fc60043561121b565b341561067857600080fd5b6102fc611244565b341561068b57600080fd5b6102c5600160a060020a0360043516611253565b34156106aa57600080fd5b6102c5600435602435611300565b34156106c357600080fd5b61032b600160a060020a03600435166114e9565b34156106e257600080fd5b6102c5600160a060020a0360043516611504565b341561070157600080fd5b6102c5611592565b341561071457600080fd5b61032b60043561161e565b341561072a57600080fd5b6102c5611887565b341561073d57600080fd5b610350611946565b341561075057600080fd5b61075b6004356119b1565b60405163ffffffff909116815260200160405180910390f35b341561077f57600080fd5b6102fc6004356119de565b341561079557600080fd5b6102c5600160a060020a03600435166024356119f9565b34156107b757600080fd5b61032b611a45565b34156107ca57600080fd5b6102fc611a4b565b34156107dd57600080fd5b61032b611a5a565b34156107f057600080fd5b61032b611a60565b341561080357600080fd5b6102c5600435611a66565b341561081957600080fd5b6102c560043563ffffffff60243516611b57565b341561083857600080fd5b61040f600435611bc9565b341561084e57600080fd5b61032b611c92565b341561086157600080fd5b6102fc611c96565b341561087457600080fd5b61087f600435611ca5565b6040519915158a5297151560208a01526040808a01979097526060890195909552608088019390935260a087019190915260c086015260e0850152610100840152610120830191909152610140909101905180910390f35b34156108e257600080fd5b61032b611e06565b6102c5600435602435611e0c565b341561090357600080fd5b61032b611ff3565b341561091657600080fd5b6102fc611ff9565b6102c5600435602435612008565b60025433600160a060020a0390811691161461094757600080fd5b60025460a060020a900460ff161561095e57600080fd5b61096830836120ba565b151561097357600080fd5b61097e3082846120da565b5050565b600154600160a060020a031681565b60145481565b600a8054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610a2d5780601f10610a0257610100808354040283529160200191610a2d565b820191906000526020600020905b815481529060010190602001808311610a1057829003601f168201915b505050505081565b60025460a060020a900460ff1615610a4c57600080fd5b610a5633826120ba565b1515610a6157600080fd5b610a6b81836121b3565b8082600160a060020a031633600160a060020a03167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92560405160405180910390a45050565b600054600160a060020a031681565b60015b90565b6000805433600160a060020a03908116911614610ae157600080fd5b5080600160a060020a0381166376190f8f6000604051602001526040518163ffffffff1660e060020a028152600401602060405180830381600087803b1515610b2957600080fd5b6102c65a03f11515610b3a57600080fd5b505050604051805190501515610b4f57600080fd5b600f8054600160a060020a031916600160a060020a039290921691909117905550565b6005546000190190565b600f54600160a060020a031681565b60025460a060020a900460ff1615610ba257600080fd5b610bac33826121e1565b1515610bb757600080fd5b610bc183826120ba565b1515610bcc57600080fd5b610bd78383836120da565b505050565b6000805433600160a060020a03908116911614610bf857600080fd5b5080600160a060020a0381166354c15b826000604051602001526040518163ffffffff1660e060020a028152600401602060405180830381600087803b1515610c4057600080fd5b6102c65a03f11515610c5157600080fd5b505050604051805190501515610c6657600080fd5b600d8054600160a060020a031916600160a060020a039290921691909117905550565b60005433600160a060020a03908116911614610ca457600080fd5b600160a060020a0381161515610cb957600080fd5b60008054600160a060020a031916600160a060020a0392909216919091179055565b60005433600160a060020a03908116911614610cf657600080fd5b600160a060020a0381161515610d0b57600080fd5b60028054600160a060020a031916600160a060020a0392909216919091179055565b60025460a060020a900460ff1615610d4457600080fd5b610d4e33856120ba565b1515610d5957600080fd5b600e54610d70908590600160a060020a03166121b3565b600e54600160a060020a03166327ebe40a858585853360405160e060020a63ffffffff88160281526004810195909552602485019390935260448401919091526064830152600160a060020a0316608482015260a401600060405180830381600087803b1515610ddf57600080fd5b6102c65a03f11515610df057600080fd5b50505050505050565b60005433600160a060020a03908116911614610e1457600080fd5b60025460a060020a900460ff161515610e2c57600080fd5b600e54600160a060020a03161515610e4357600080fd5b600f54600160a060020a03161515610e5a57600080fd5b600d54600160a060020a03161515610e7157600080fd5b601654600160a060020a031615610e8757600080fd5b610e8f612201565b565b60115481565b600960205260009081526040902054600160a060020a031681565b60008080808511610ec257600080fd5b60008411610ecf57600080fd5b6005805486908110610edd57fe5b90600052602060002090600202019150600584815481101515610efc57fe5b90600052602060002090600202019050610f1882868387612254565b8015610f295750610f2984866123d4565b92505b505092915050565b60008060015b610f42610b72565b8111610f8957600081815260066020526040902054600160a060020a0386811691161415610f815783821415610f7a57809250610f2c565b6001909101905b600101610f3a565b600080fd5b600860205260009081526040902054600160a060020a031681565b60025460a060020a900460ff1615610fc057600080fd5b610fca33856120ba565b1515610fd557600080fd5b610fde84611bc9565b1515610fe957600080fd5b600f54611000908590600160a060020a03166121b3565b600f54600160a060020a03166327ebe40a858585853360405160e060020a63ffffffff88160281526004810195909552602485019390935260448401919091526064830152600160a060020a0316608482015260a401600060405180830381600087803b1515610ddf57600080fd5b60025433600160a060020a0390811691161461108a57600080fd5b600c55565b60025460a060020a900460ff16156110a657600080fd5b6110b033826120ba565b15156110bb57600080fd5b60009081526009602052604090208054600160a060020a031916600160a060020a0392909216919091179055565b60005433600160a060020a0390811691161461110457600080fd5b600160a060020a038116151561111957600080fd5b60018054600160a060020a031916600160a060020a0392909216919091179055565b60025433600160a060020a0390811691161461115657600080fd5b600160a060020a03811615156111745750600254600160a060020a03165b6010546014541061118457600080fd5b6011546015541061119457600080fd5b601480546001908101909155601580549091019055610bd7600080808585612429565b60025460a060020a900460ff1681565b60015433600160a060020a039081169116146111e257600080fd5b600154600160a060020a039081169030163180156108fc0290604051600060405180830381858888f193505050501515610e8f57600080fd5b600081815260066020526040902054600160a060020a031680151561123f57600080fd5b919050565b601654600160a060020a031681565b6000805433600160a060020a0390811691161461126f57600080fd5b5080600160a060020a0381166385b861886000604051602001526040518163ffffffff1660e060020a028152600401602060405180830381600087803b15156112b757600080fd5b6102c65a03f115156112c857600080fd5b5050506040518051905015156112dd57600080fd5b600e8054600160a060020a031916600160a060020a039290921691909117905550565b600254600090819060a060020a900460ff161561131c57600080fd5b61132633856120ba565b151561133157600080fd5b61133b83856123d4565b151561134657600080fd5b600580548590811061135457fe5b906000526020600020906002020191506113f98261010060405190810160409081528254825260019092015467ffffffffffffffff8082166020840152680100000000000000008204169282019290925263ffffffff608060020a83048116606083015260a060020a83048116608083015260c060020a83041660a082015261ffff60e060020a8304811660c083015260f060020a90920490911660e08201526126af565b151561140457600080fd5b600580548490811061141257fe5b906000526020600020906002020190506114b78161010060405190810160409081528254825260019092015467ffffffffffffffff8082166020840152680100000000000000008204169282019290925263ffffffff608060020a83048116606083015260a060020a83048116608083015260c060020a83041660a082015261ffff60e060020a8304811660c083015260f060020a90920490911660e08201526126af565b15156114c257600080fd5b6114ce82858386612254565b15156114d957600080fd5b6114e384846126dd565b50505050565b600160a060020a031660009081526007602052604090205490565b60005433600160a060020a0390811691161461151f57600080fd5b60025460a060020a900460ff16151561153757600080fd5b60168054600160a060020a031916600160a060020a0383161790557f450db8da6efbe9c22f2347f7c2021231df1fc58d3ae9a2fa75d39fa44619930581604051600160a060020a03909116815260200160405180910390a150565b60025433600160a060020a03908116911614806115bd575060005433600160a060020a039081169116145b806115d6575060015433600160a060020a039081169116145b15156115e157600080fd5b60025460a060020a900460ff16156115f857600080fd5b6002805474ff0000000000000000000000000000000000000000191660a060020a179055565b600080600080600080600080600260149054906101000a900460ff1615151561164657600080fd5b600580548a90811061165457fe5b60009182526020909120600290910201600181015490975067ffffffffffffffff16151561168157600080fd5b6117168761010060405190810160409081528254825260019092015467ffffffffffffffff8082166020840152680100000000000000008204169282019290925263ffffffff608060020a83048116606083015260a060020a83048116608083015260c060020a83041660a082015261ffff60e060020a8304811660c083015260f060020a90920490911660e082015261280e565b151561172157600080fd5b60018701546005805460c060020a90920463ffffffff169750908790811061174557fe5b600091825260209091206001808a015460029093029091019081015490965061ffff60f060020a9283900481169650919004168490111561179357600185015460f060020a900461ffff1693505b600d5487548654600160a060020a0390921691638d8b1b88919060006040516020015260405160e060020a63ffffffff851602815260048101929092526024820152604401602060405180830381600087803b15156117f157600080fd5b6102c65a03f1151561180257600080fd5b505050604051805160008b81526006602052604090205460018a810154929650600160a060020a03909116945061185192508b9160c060020a900463ffffffff1690870161ffff168686612429565b60019790970180547bffffffff000000000000000000000000000000000000000000000000191690555094979650505050505050565b60025433600160a060020a039081169116146118a257600080fd5b600e54600160a060020a0316635fd8c7106040518163ffffffff1660e060020a028152600401600060405180830381600087803b15156118e157600080fd5b6102c65a03f115156118f257600080fd5b5050600f54600160a060020a03169050635fd8c7106040518163ffffffff1660e060020a028152600401600060405180830381600087803b151561193557600080fd5b6102c65a03f11515610bd757600080fd5b600b8054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610a2d5780601f10610a0257610100808354040283529160200191610a2d565b600381600e81106119be57fe5b60089182820401919006600402915054906101000a900463ffffffff1681565b600660205260009081526040902054600160a060020a031681565b60025460a060020a900460ff1615611a1057600080fd5b600160a060020a0382161515611a2557600080fd5b611a2f33826120ba565b1515611a3a57600080fd5b61097e3383836120da565b60125481565b600254600160a060020a031681565b600c5481565b60105481565b60025460009033600160a060020a03908116911614611a8457600080fd5b60115460155410611a9457600080fd5b611aa360008060008530612429565b600e54909150611abd908290600160a060020a03166121b3565b600e54600160a060020a03166327ebe40a82611ad761283c565b60006013543060405160e060020a63ffffffff88160281526004810195909552602485019390935260448401919091526064830152600160a060020a0316608482015260a401600060405180830381600087803b1515611b3657600080fd5b6102c65a03f11515611b4757600080fd5b5050601580546001019055505050565b60025460009033600160a060020a03908116911614611b7557600080fd5b60025460a060020a900460ff1615611b8c57600080fd5b600063ffffffff831611611b9f57600080fd5b5060005b8163ffffffff16811015610bd757611bc060008060008633612429565b50600101611ba3565b600080808311611bd857600080fd5b6005805484908110611be657fe5b90600052602060002090600202019050611c8b8161010060405190810160409081528254825260019092015467ffffffffffffffff8082166020840152680100000000000000008204169282019290925263ffffffff608060020a83048116606083015260a060020a83048116608083015260c060020a83041660a082015261ffff60e060020a8304811660c083015260f060020a90920490911660e08201526126af565b9392505050565b4290565b600e54600160a060020a031681565b600080600080600080600080600080600060058c815481101515611cc557fe5b906000526020600020906002020190508060010160189054906101000a900463ffffffff1663ffffffff16600014159a50428160010160089054906101000a900467ffffffffffffffff1667ffffffffffffffff161115995080600101601c9054906101000a900461ffff1661ffff1698508060010160089054906101000a900467ffffffffffffffff1667ffffffffffffffff1697508060010160189054906101000a900463ffffffff1663ffffffff1696508060010160009054906101000a900467ffffffffffffffff1667ffffffffffffffff1695508060010160109054906101000a900463ffffffff1663ffffffff1694508060010160149054906101000a900463ffffffff1663ffffffff16935080600101601e9054906101000a900461ffff1661ffff16925080600001549150509193959799509193959799565b60135481565b60025460009081908190819060a060020a900460ff1615611e2c57600080fd5b611e3633866120ba565b1515611e4157600080fd5b611e4a85611bc9565b1515611e5557600080fd5b611e5f85876128de565b1515611e6a57600080fd5b600f54600160a060020a031663c55d0f568760006040516020015260405160e060020a63ffffffff84160281526004810191909152602401602060405180830381600087803b1515611ebb57600080fd5b6102c65a03f11515611ecc57600080fd5b5050506040518051600c5490955034945060009350850184109050611ef757600c5483039250600191505b600f54600160a060020a031663454a2ab3848860405160e060020a63ffffffff851602815260048101919091526024016000604051808303818588803b1515611f3f57600080fd5b6125ee5a03f11515611f5057600080fd5b50505050611f6a8563ffffffff168763ffffffff166126dd565b8115611feb576005805486908110611f7e57fe5b906000526020600020906002020190507f1c2771fbe007c332593b3adcacf033ce4a97f9cb1f6dd81e40d9a42c66d2e65c858260010160089054906101000a900467ffffffffffffffff1660405191825267ffffffffffffffff1660208201526040908101905180910390a15b505050505050565b60155481565b600d54600160a060020a031681565b60025460009060a060020a900460ff161561202257600080fd5b600c5434101561203157600080fd5b61203b8383611300565b600580548490811061204957fe5b906000526020600020906002020190507f1c2771fbe007c332593b3adcacf033ce4a97f9cb1f6dd81e40d9a42c66d2e65c838260010160089054906101000a900467ffffffffffffffff1660405191825267ffffffffffffffff1660208201526040908101905180910390a1505050565b600090815260066020526040902054600160a060020a0391821691161490565b600160a060020a03808316600081815260076020908152604080832080546001019055858352600690915290208054600160a060020a031916909117905583161561216d57600160a060020a03831660009081526007602090815260408083208054600019019055838352600982528083208054600160a060020a03199081169091556008909252909120805490911690555b8082600160a060020a031684600160a060020a03167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60405160405180910390a4505050565b6000918252600860205260409091208054600160a060020a031916600160a060020a03909216919091179055565b600090815260086020526040902054600160a060020a0391821691161490565b60005433600160a060020a0390811691161461221c57600080fd5b60025460a060020a900460ff16151561223457600080fd5b6002805474ff000000000000000000000000000000000000000019169055565b600081841415612266575060006123cc565b6001850154608060020a900463ffffffff168214806122955750600185015460a060020a900463ffffffff1682145b156122a2575060006123cc565b6001830154608060020a900463ffffffff168414806122d15750600183015460a060020a900463ffffffff1684145b156122de575060006123cc565b6001830154608060020a900463ffffffff16158061230b57506001850154608060020a900463ffffffff16155b15612318575060016123cc565b60018581015490840154608060020a9182900463ffffffff90811692909104161480612363575060018086015490840154608060020a900463ffffffff90811660a060020a90920416145b15612370575060006123cc565b6001808601549084015460a060020a900463ffffffff908116608060020a9092041614806123bb57506001858101549084015460a060020a9182900463ffffffff9081169290910416145b156123c8575060006123cc565b5060015b949350505050565b6000818152600660205260408082205484835290822054600160a060020a03918216911680821480610f295750600085815260096020526040902054600160a060020a03908116908316149250505092915050565b60006124336129fd565b600063ffffffff88111561244657600080fd5b63ffffffff87111561245757600080fd5b61ffff86111561246657600080fd5b610100604051908101604090815286825267ffffffffffffffff42166020830152600090820181905263ffffffff808b1660608401528916608083015260a0820181905260c082015261ffff871660e0820152600580549193506001918083016124d08382612a41565b6000928352602090922085916002020181518155602082015160018201805467ffffffffffffffff191667ffffffffffffffff9290921691909117905560408201518160010160086101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060608201518160010160106101000a81548163ffffffff021916908363ffffffff16021790555060808201518160010160146101000a81548163ffffffff021916908363ffffffff16021790555060a08201518160010160186101000a81548163ffffffff021916908363ffffffff16021790555060c082015181600101601c6101000a81548161ffff021916908361ffff16021790555060e08201516001909101805461ffff9290921660f060020a027dffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9092169190911790555003905063ffffffff81111561262a57600080fd5b83600160a060020a03167f0a5311bd2a6608f08a180df2ee7c5946819a649b204b554bb8e39825b2c50ad582846060015163ffffffff16856080015163ffffffff1686516040518085815260200184815260200183815260200182815260200194505050505060405180910390a26126a4600085836120da565b979650505050505050565b60008160a0015163ffffffff161580156126d7575042826040015167ffffffffffffffff1611155b92915050565b6000806005838154811015156126ef57fe5b9060005260206000209060020201915060058481548110151561270e57fe5b600091825260209091206002909102016001810180547bffffffff000000000000000000000000000000000000000000000000191660c060020a63ffffffff871602179055905061275e8261292d565b6127678161292d565b60008481526009602090815260408083208054600160a060020a031990811690915586845281842080549091169055868352600690915290819020547f6b4808987a5cecdf67d54ca5dc20664fafca80ef7195097800c12549245ab20d91600160a060020a039091169086908690518084600160a060020a0316600160a060020a03168152602001838152602001828152602001935050505060405180910390a150505050565b60008160a0015163ffffffff16158015906126d7575042826040015167ffffffffffffffff16111592915050565b600e5460009081908190600160a060020a031663eac9d94c82604051602001526040518163ffffffff1660e060020a028152600401602060405180830381600087803b151561288a57600080fd5b6102c65a03f1151561289b57600080fd5b50505060405180519250506fffffffffffffffffffffffffffffffff82106128c257600080fd5b60028204820190506012548110156126d7575060125492915050565b60008060006005858154811015156128f257fe5b9060005260206000209060020201915060058481548110151561291157fe5b90600052602060002090600202019050610f2982868387612254565b600181015460039060e060020a900461ffff16600e811061294a57fe5b600880820492909201546001840180546fffffffffffffffff0000000000000000191668010000000000000000949093066004026101000a90910463ffffffff16420167ffffffffffffffff16929092021790819055600d60e060020a90910461ffff1610156129fa576001818101805461ffff60e060020a8083048216909401169092027fffff0000ffffffffffffffffffffffffffffffffffffffffffffffffffffffff9092169190911790555b50565b6101006040519081016040908152600080835260208301819052908201819052606082018190526080820181905260a0820181905260c0820181905260e082015290565b815481835581811511610bd757600083815260209020610bd791610ac29160029182028101918502015b80821115612a855760008082556001820155600201612a6b565b50905600a165627a7a7230582026e83840838bc753edf9e3a19e2f02642d263f578d4117a376c0eeab435ef39b0029")
	createResult, contractAddress, createLeftGas, createErr := mockCreate(contractCodeBytes, config)
	fmt.Printf("New create contract address:%s\n", contractAddress.GetHexString())
	fmt.Printf("New create contract createResult:%v,%d\n", createResult, len(createResult))
	fmt.Printf("New create contract costGas:%v,createErr:%v\n", config.GasLimit-createLeftGas, createErr)
}
